# AWSç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰ - å†…éƒ¨çµ±åˆ¶ãƒ†ã‚¹ãƒˆè©•ä¾¡AIã‚·ã‚¹ãƒ†ãƒ 

> **å¯¾è±¡èª­è€…**: AWSã‚’åˆã‚ã¦ä½¿ã†æ–¹ã§ã‚‚ã€ã“ã®ã‚¬ã‚¤ãƒ‰ã«æ²¿ã£ã¦é€²ã‚ã‚Œã°ç’°å¢ƒæ§‹ç¯‰ãŒå®Œäº†ã—ã¾ã™ã€‚
> **æ‰€è¦æ™‚é–“**: ç´„3ã€œ5æ™‚é–“ï¼ˆBedrockãƒ¢ãƒ‡ãƒ«ã‚¢ã‚¯ã‚»ã‚¹æ‰¿èªã®å¾…ã¡æ™‚é–“ã‚’é™¤ãï¼‰
> **æœ€çµ‚æ›´æ–°**: 2026å¹´2æœˆ

---

## ç›®æ¬¡

1. [ã¯ã˜ã‚ã«](#1-ã¯ã˜ã‚ã«)
2. [AWSã¨ã¯](#2-awsã¨ã¯)
3. [AWS CLIã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](#3-aws-cliã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—)
4. [IAMï¼ˆIdentity and Access Managementï¼‰](#4-iamidentity-and-access-management)
5. [AWS Lambda](#5-aws-lambda)
6. [Amazon Bedrock](#6-amazon-bedrock)
7. [Amazon Textract](#7-amazon-textract)
8. [API Gateway](#8-api-gateway)
9. [Secrets Manager](#9-secrets-manager)
10. [CloudWatch / X-Ray](#10-cloudwatch--x-ray)
11. [S3](#11-s3)
12. [Terraformãƒ‡ãƒ—ãƒ­ã‚¤](#12-terraformãƒ‡ãƒ—ãƒ­ã‚¤)
13. [çµ±åˆãƒ†ã‚¹ãƒˆ](#13-çµ±åˆãƒ†ã‚¹ãƒˆ)
14. [ã‚³ã‚¹ãƒˆç®¡ç†](#14-ã‚³ã‚¹ãƒˆç®¡ç†)
15. [ã¾ã¨ã‚ãƒ»æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—](#15-ã¾ã¨ã‚æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—)

---

## è¨˜å·ã®èª¬æ˜

| è¨˜å· | æ„å‘³ |
|------|------|
| ğŸ’¡ | ãƒ’ãƒ³ãƒˆãƒ»è£œè¶³æƒ…å ± |
| âš ï¸ | æ³¨æ„ãƒ»è­¦å‘Š |
| âœ… | ç¢ºèªãƒã‚¤ãƒ³ãƒˆãƒ»æ¤œè¨¼æ‰‹é † |
| ğŸ“‹ | å‰ææ¡ä»¶ãƒ»æº–å‚™äº‹é … |
| ğŸ”§ | ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° |

---

## 1. ã¯ã˜ã‚ã«

### ã“ã®ã‚¬ã‚¤ãƒ‰ã®ç›®çš„

ã“ã®ã‚¬ã‚¤ãƒ‰ã¯ã€**å†…éƒ¨çµ±åˆ¶ãƒ†ã‚¹ãƒˆè©•ä¾¡AIã‚·ã‚¹ãƒ†ãƒ **ã‚’AWSä¸Šã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãŸã‚ã®æ‰‹é †æ›¸ã§ã™ã€‚
ã‚¯ãƒ©ã‚¦ãƒ‰çµŒé¨“ãŒå…¨ããªã„æ–¹ã§ã‚‚ã€1ã¤ãšã¤æ‰‹é †ã‚’è¿½ãˆã°ç’°å¢ƒæ§‹ç¯‰ãŒå®Œäº†ã™ã‚‹ã‚ˆã†è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚

ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã¯ä»¥ä¸‹ã®AWSã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ç”¨ã—ã¾ã™ï¼š

| AWSã‚µãƒ¼ãƒ“ã‚¹ | å½¹å‰² |
|-------------|------|
| **IAM** | ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãƒ»æ¨©é™ç®¡ç† |
| **Lambda** | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIå‡¦ç†ï¼ˆã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ï¼‰ |
| **Bedrock** | AI/LLMï¼ˆClaude Sonnetï¼‰ã«ã‚ˆã‚‹è©•ä¾¡ |
| **Textract** | æ›¸é¡ã®OCRï¼ˆæ–‡å­—èªè­˜ï¼‰ |
| **API Gateway** | REST APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå…¬é–‹ |
| **Secrets Manager** | APIã‚­ãƒ¼ãƒ»æ©Ÿå¯†æƒ…å ±ã®å®‰å…¨ãªç®¡ç† |
| **CloudWatch** | ãƒ­ã‚°ãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ»ã‚¢ãƒ©ãƒ¼ãƒ  |
| **X-Ray** | åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ï¼ˆå‡¦ç†è¿½è·¡ï¼‰ |
| **S3** | ãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ |

### ğŸ“‹ å‰ææ¡ä»¶ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

é–‹å§‹å‰ã«ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

- [ ] ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ã‚’ç”¨æ„ã—ã¦ã„ã‚‹ï¼ˆAWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆã«å¿…è¦ï¼‰
- [ ] Python 3.11ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹
- [ ] Git ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ï¼ˆVS Codeæ¨å¥¨ï¼‰ãŒã‚ã‚‹
- [ ] ã‚¿ãƒ¼ãƒŸãƒŠãƒ«/ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’é–‹ã‘ã‚‹
- [ ] æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³æ¸ˆã¿ã§ã‚ã‚‹

### æ‰€è¦æ™‚é–“ã®ç›®å®‰

| ã‚»ã‚¯ã‚·ãƒ§ãƒ³ | ç›®å®‰ |
|-----------|------|
| AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ | 15åˆ† |
| AWS CLIè¨­å®š | 20åˆ† |
| IAMè¨­å®š | 20åˆ† |
| Bedrockãƒ¢ãƒ‡ãƒ«ç”³è«‹ | 10åˆ†ï¼ˆæ‰¿èªã¾ã§æ•°æ™‚é–“ã€œ1å–¶æ¥­æ—¥ï¼‰ |
| Terraformãƒ‡ãƒ—ãƒ­ã‚¤ | 30åˆ† |
| çµ±åˆãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼ | 30åˆ† |

---

## 2. AWSã¨ã¯

### ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã®æ¦‚è¦

**AWSï¼ˆAmazon Web Servicesï¼‰** ã¯ã€AmazonãŒæä¾›ã™ã‚‹ã‚¯ãƒ©ã‚¦ãƒ‰ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚
è‡ªç¤¾ã§ã‚µãƒ¼ãƒãƒ¼ã‚’è³¼å…¥ãƒ»ç®¡ç†ã™ã‚‹ä»£ã‚ã‚Šã«ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆçµŒç”±ã§ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒªã‚½ãƒ¼ã‚¹ã‚’å¿…è¦ãªåˆ†ã ã‘ã€Œå€Ÿã‚Šã‚‹ã€ã“ã¨ãŒã§ãã¾ã™ã€‚

ä¸»è¦ãªã‚µãƒ¼ãƒ“ã‚¹ã‚«ãƒ†ã‚´ãƒªï¼š

| ã‚«ãƒ†ã‚´ãƒª | ä»£è¡¨ã‚µãƒ¼ãƒ“ã‚¹ | èª¬æ˜ |
|---------|-------------|------|
| ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° | EC2, Lambda | ã‚µãƒ¼ãƒãƒ¼ãƒ»é–¢æ•°å®Ÿè¡Œ |
| ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ | S3 | ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ |
| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ | DynamoDB, RDS | ãƒ‡ãƒ¼ã‚¿ç®¡ç† |
| AI/ML | Bedrock, Textract | AIãƒ»æ©Ÿæ¢°å­¦ç¿’ |
| ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ | API Gateway, VPC | é€šä¿¡ãƒ»APIå…¬é–‹ |
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ | IAM, Secrets Manager | èªè¨¼ãƒ»æ©Ÿå¯†ç®¡ç† |
| ç›£è¦– | CloudWatch, X-Ray | ãƒ­ã‚°ãƒ»ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚° |

### ãªãœAWSã‚’ä½¿ã†ã®ã‹

- **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: åˆ©ç”¨é‡ã«å¿œã˜ã¦è‡ªå‹•ã§ãƒªã‚½ãƒ¼ã‚¹ãŒå¢—æ¸›ã™ã‚‹
- **å¾“é‡èª²é‡‘**: ä½¿ã£ãŸåˆ†ã ã‘æ–™é‡‘ãŒç™ºç”Ÿï¼ˆåˆæœŸè²»ç”¨ä¸è¦ï¼‰
- **ãƒãƒãƒ¼ã‚¸ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹**: ã‚µãƒ¼ãƒãƒ¼ç®¡ç†ã¯AWSãŒè¡Œã†ï¼ˆç‰¹ã«Lambdaï¼‰
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºç´šã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŸºç›¤
- **Bedrock**: Claude Sonnetãªã©ã®æœ€æ–°AIãƒ¢ãƒ‡ãƒ«ã‚’APIã§åˆ©ç”¨å¯èƒ½

### AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆæ‰‹é †

1. **[AWSå…¬å¼ã‚µã‚¤ãƒˆ](https://aws.amazon.com/)** ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ã€Œç„¡æ–™ã§ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåã‚’å…¥åŠ›
4. é€£çµ¡å…ˆæƒ…å ±ã‚’å…¥åŠ›
5. ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰æƒ…å ±ã‚’å…¥åŠ›ï¼ˆç„¡æ–™æ å†…ã§ã‚ã‚Œã°èª²é‡‘ãªã—ï¼‰
6. é›»è©±ç•ªå·èªè¨¼ã‚’å®Œäº†
7. ã‚µãƒãƒ¼ãƒˆãƒ—ãƒ©ãƒ³ã¯ **ã€Œãƒ™ãƒ¼ã‚·ãƒƒã‚¯ï¼ˆç„¡æ–™ï¼‰ã€** ã‚’é¸æŠ

ğŸ’¡ **ç„¡æ–™æ ã«ã¤ã„ã¦**: AWSã¯æ–°è¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆã‹ã‚‰12ã‹æœˆé–“ã€å¤šãã®ã‚µãƒ¼ãƒ“ã‚¹ã§ç„¡æ–™æ ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚
Lambda ã¯æ¯æœˆ100ä¸‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‹40ä¸‡GBç§’ã¾ã§ç„¡æ–™ã§ã™ã€‚

âš ï¸ **æ³¨æ„**: ãƒ«ãƒ¼ãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆæœ€åˆã«ä½œæˆã—ãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼‰ã¯æ—¥å¸¸ä½œæ¥­ã«ã¯ä½¿ã‚ãšã€
å¾Œè¿°ã®IAMãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã—ã¦ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚ãƒ«ãƒ¼ãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®æ¼æ´©ã¯å…¨ãƒªã‚½ãƒ¼ã‚¹ã¸ã®ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã«ã¤ãªãŒã‚Šã¾ã™ã€‚

### AWS Management Consoleã®åŸºæœ¬æ“ä½œ

AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ãŸã‚‰ã€[AWS Management Console](https://console.aws.amazon.com/) ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚

- **æ¤œç´¢ãƒãƒ¼**: ç”»é¢ä¸Šéƒ¨ã®æ¤œç´¢ãƒãƒ¼ã§ã‚µãƒ¼ãƒ“ã‚¹åã‚’å…¥åŠ›ã™ã‚‹ã¨ã™ãã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™
- **ãƒªãƒ¼ã‚¸ãƒ§ãƒ³é¸æŠ**: å³ä¸Šã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ **ã€Œã‚¢ã‚¸ã‚¢ãƒ‘ã‚·ãƒ•ã‚£ãƒƒã‚¯ (æ±äº¬) ap-northeast-1ã€** ã‚’é¸æŠã—ã¦ãã ã•ã„
- **ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ãƒ‹ãƒ¥ãƒ¼**: å·¦ä¸Šã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰å…¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä¸€è¦§ã§ãã¾ã™

âœ… **ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**: ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å³ä¸Šã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãŒã€Œæ±äº¬ï¼ˆap-northeast-1ï¼‰ã€ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãŒé•ã†ã¨ã€ä½œæˆã—ãŸãƒªã‚½ãƒ¼ã‚¹ãŒè¦‹ã¤ã‹ã‚‰ãªããªã‚Šã¾ã™ã€‚

---

## 3. AWS CLIã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### AWS CLIã¨ã¯

**AWS CLIï¼ˆCommand Line Interfaceï¼‰** ã¯ã€ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ï¼ˆã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼‰ã‹ã‚‰AWSã‚µãƒ¼ãƒ“ã‚¹ã‚’æ“ä½œã™ã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç”»é¢ã§ã‚‚åŒã˜æ“ä½œãŒã§ãã¾ã™ãŒã€CLIã‚’ä½¿ã†ç†ç”±ã¯ï¼š

- **è‡ªå‹•åŒ–**: ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§åå¾©ä½œæ¥­ã‚’è‡ªå‹•åŒ–ã§ãã‚‹
- **å†ç¾æ€§**: åŒã˜ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚Œã°åŒã˜çµæœã«ãªã‚‹
- **åŠ¹ç‡æ€§**: ãƒ–ãƒ©ã‚¦ã‚¶æ“ä½œã‚ˆã‚Šé«˜é€Ÿ
- **Terraformé€£æº**: Infrastructure as Codeã«å¿…é ˆ

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †

#### Windows ã®å ´åˆ

```bash
# MSIã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦å®Ÿè¡Œ
# å…¬å¼ãƒšãƒ¼ã‚¸: https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html

# PowerShellã§ä»¥ä¸‹ã‚’å®Ÿè¡Œ
msiexec.exe /i https://awscli.amazonaws.com/AWSCLIV2.msi

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª
aws --version
```

æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ï¼š
```
aws-cli/2.x.x Python/3.x.x Windows/10 exe/AMD64
```

#### macOS ã®å ´åˆ

```bash
# Homebrewã‚’ä½¿ã†å ´åˆ
brew install awscli

# ã¾ãŸã¯pkgã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼
curl "https://awscli.amazonaws.com/AWSCLIV2.pkg" -o "AWSCLIV2.pkg"
sudo installer -pkg AWSCLIV2.pkg -target /

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª
aws --version
```

#### Linux ã®å ´åˆ

```bash
curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
unzip awscliv2.zip
sudo ./aws/install

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª
aws --version
```

### IAMãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆã¨ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼å–å¾—

AWS CLIã®èªè¨¼è¨­å®šã‚’ã™ã‚‹å‰ã«ã€ã¾ãšIAMãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã—ã€ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã‚’å–å¾—ã—ã¾ã™ã€‚

1. AWS Management Console ã«ãƒ«ãƒ¼ãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³
2. æ¤œç´¢ãƒãƒ¼ã«ã€ŒIAMã€ã¨å…¥åŠ›ã—ã€IAMã‚µãƒ¼ãƒ“ã‚¹ã‚’é–‹ã
3. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
4. ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¿½åŠ ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
5. ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›ï¼ˆä¾‹: `ic-test-admin`ï¼‰
6. ã€ŒAWS ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¸ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚»ã‚¹ã‚’æä¾›ã™ã‚‹ã€ã«ãƒã‚§ãƒƒã‚¯
7. ã€Œãƒãƒªã‚·ãƒ¼ã‚’ç›´æ¥ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ã€ã‚’é¸æŠ
8. `AdministratorAccess` ãƒãƒªã‚·ãƒ¼ã‚’æ¤œç´¢ã—ã¦ãƒã‚§ãƒƒã‚¯
9. ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯

âš ï¸ **æ³¨æ„**: `AdministratorAccess` ã¯é–‹ç™ºãƒ»ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ®µéšã§ã¯ä¾¿åˆ©ã§ã™ãŒã€
æœ¬ç•ªç’°å¢ƒã§ã¯æœ€å°æ¨©é™ã®åŸå‰‡ã«å¾“ã„ã€å¿…è¦ãªãƒãƒªã‚·ãƒ¼ã ã‘ã‚’ä»˜ä¸ã—ã¦ãã ã•ã„ã€‚

æ¬¡ã«ã€ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã‚’ä½œæˆã—ã¾ã™ï¼š

1. ä½œæˆã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’ã‚¯ãƒªãƒƒã‚¯
2. ã€Œã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£èªè¨¼æƒ…å ±ã€ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ã€Œã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã‚’ä½œæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯
4. ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã§ã€Œã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ (CLI)ã€ã‚’é¸æŠ
5. ã€Œã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã‚’ä½œæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯
6. **ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ID** ã¨ **ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼** ã‚’å®‰å…¨ã«ä¿å­˜

âš ï¸ **é‡è¦**: ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã¯ã€ã“ã®ç”»é¢ã§ã—ã‹è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚
å¿…ãšãƒ¡ãƒ¢ã‚’å–ã‚‹ã‹ã€CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚
ç´›å¤±ã—ãŸå ´åˆã¯ã€æ–°ã—ã„ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã‚’å†ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### aws configureï¼ˆèªè¨¼è¨­å®šï¼‰

å–å¾—ã—ãŸã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã‚’ä½¿ã£ã¦AWS CLIã‚’è¨­å®šã—ã¾ã™ã€‚

```bash
aws configure
```

ä»¥ä¸‹ã®ã‚ˆã†ã«é †ç•ªã«å…¥åŠ›ã‚’æ±‚ã‚ã‚‰ã‚Œã¾ã™ï¼š

```
AWS Access Key ID [None]: AKIAIOSFODNN7EXAMPLE        # å–å¾—ã—ãŸã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ID  # pragma: allowlist secret
AWS Secret Access Key [None]: wJalrXUtnFEMI/K7MDENG... # å–å¾—ã—ãŸã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼  # pragma: allowlist secret
Default region name [None]: ap-northeast-1              # æ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³
Default output format [None]: json                      # JSONå½¢å¼ã§å‡ºåŠ›
```

ğŸ’¡ **ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«ã¤ã„ã¦**: `ap-northeast-1` ã¯æ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã§ã™ã€‚
æ—¥æœ¬ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã§ã¯æœ€ã‚‚ä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ã§åˆ©ç”¨ã§ãã¾ã™ã€‚
æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã“ã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã®ä½¿ç”¨ã‚’æ¨å¥¨ã—ã¦ã„ã¾ã™ã€‚

### èªè¨¼ç¢ºèª

è¨­å®šãŒæ­£ã—ã„ã‹ç¢ºèªã—ã¾ã™ã€‚

```bash
aws sts get-caller-identity
```

æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ï¼š
```json
{
    "UserId": "AIDAIOSFODNN7EXAMPLE",
    "Account": "123456789012",
    "Arn": "arn:aws:iam::123456789012:user/ic-test-admin"
}
```

âœ… **ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**:
- `Account` ã«AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆIDãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹
- `Arn` ã«ä½œæˆã—ãŸIAMãƒ¦ãƒ¼ã‚¶ãƒ¼åãŒå«ã¾ã‚Œã¦ã„ã‚‹
- ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãªã„

### ğŸ”§ ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼

| ã‚¨ãƒ©ãƒ¼ | åŸå›  | è§£æ±ºæ–¹æ³• |
|--------|------|----------|
| `Unable to locate credentials` | aws configureãŒæœªå®Ÿè¡Œ | `aws configure` ã‚’å†å®Ÿè¡Œ |
| `InvalidClientTokenId` | ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ãŒé–“é•ã£ã¦ã„ã‚‹ | IAMã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚­ãƒ¼ã‚’å†ç¢ºèª |
| `SignatureDoesNotMatch` | ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼ãŒé–“é•ã£ã¦ã„ã‚‹ | æ–°ã—ã„ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã‚’å†ä½œæˆ |
| `ExpiredToken` | ä¸€æ™‚èªè¨¼æƒ…å ±ã®æœŸé™åˆ‡ã‚Œ | `aws configure` ã§å†è¨­å®š |
| ã‚³ãƒãƒ³ãƒ‰ãŒè¦‹ã¤ã‹ã‚‰ãªã„ | AWS CLIãŒæœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« | ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †ã‚’å†å®Ÿè¡Œ |

---

## 4. IAMï¼ˆIdentity and Access Managementï¼‰

### IAMã¨ã¯

**IAMï¼ˆIdentity and Access Managementï¼‰** ã¯ã€AWSãƒªã‚½ãƒ¼ã‚¹ã¸ã®ã€Œèª°ãŒã€ã€Œä½•ã‚’ã€ã§ãã‚‹ã‹ã‚’åˆ¶å¾¡ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚

ä¸»è¦ãªæ¦‚å¿µï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆ                         â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ IAMãƒ¦ãƒ¼ã‚¶ãƒ¼â”‚    â”‚ IAMãƒ­ãƒ¼ãƒ« â”‚    â”‚ IAMãƒãƒªã‚·ãƒ¼        â”‚  â”‚
â”‚  â”‚           â”‚    â”‚           â”‚    â”‚                    â”‚  â”‚
â”‚  â”‚ äººãŒä½¿ã†   â”‚    â”‚ ã‚µãƒ¼ãƒ“ã‚¹ãŒ â”‚    â”‚ æ¨©é™ã‚’å®šç¾©ã™ã‚‹     â”‚  â”‚
â”‚  â”‚ èªè¨¼æƒ…å ±   â”‚    â”‚ ä½¿ã†èªè¨¼  â”‚    â”‚ JSONãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  ãƒ¦ãƒ¼ã‚¶ãƒ¼/ãƒ­ãƒ¼ãƒ« ã«ãƒãƒªã‚·ãƒ¼ã‚’ã€Œã‚¢ã‚¿ãƒƒãƒã€ã—ã¦æ¨©é™ã‚’ä»˜ä¸     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **IAMãƒ¦ãƒ¼ã‚¶ãƒ¼**: äººé–“ãŒAWSã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ãŸã‚ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
- **IAMãƒ­ãƒ¼ãƒ«**: AWSã‚µãƒ¼ãƒ“ã‚¹ï¼ˆLambdaç­‰ï¼‰ãŒAWSãƒªã‚½ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®æ¨©é™ã‚»ãƒƒãƒˆ
- **IAMãƒãƒªã‚·ãƒ¼**: ã€Œä½•ã®ã‚µãƒ¼ãƒ“ã‚¹ã®ã€ã€Œä½•ã®æ“ä½œã‚’ã€ã€Œè¨±å¯/æ‹’å¦ã™ã‚‹ã€ã‹ã‚’å®šç¾©ã™ã‚‹JSONãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### Lambdaå®Ÿè¡Œãƒ­ãƒ¼ãƒ«ä½œæˆ

Lambdaé–¢æ•°ãŒAWSã®ä»–ã®ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆBedrockã€Textractç­‰ï¼‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®IAMãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

ğŸ’¡ **Terraformã§è‡ªå‹•ä½œæˆã•ã‚Œã‚‹å ´åˆ**: å¾Œè¿°ã®Terraformãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ä½¿ã†å ´åˆã€ã“ã®ãƒ­ãƒ¼ãƒ«ã¯è‡ªå‹•çš„ã«ä½œæˆã•ã‚Œã¾ã™ã€‚
ã“ã“ã§ã¯æ‰‹å‹•ã§ä½œæˆã™ã‚‹æ–¹æ³•ã‚’å­¦ç¿’ç›®çš„ã§èª¬æ˜ã—ã¦ã„ã¾ã™ã€‚

#### ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ã®ä½œæˆ

ã¾ãšã€ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ï¼ˆTrust Policyï¼‰ã®JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚
ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ã¯ã€Œèª°ãŒã“ã®ãƒ­ãƒ¼ãƒ«ã‚’å¼•ãå—ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã€ã‚’å®šç¾©ã—ã¾ã™ã€‚

```bash
# ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
# Windowsã®å ´åˆã¯PowerShellã§Out-Fileã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„
```

ä»¥ä¸‹ã®å†…å®¹ã§ `trust-policy.json` ã‚’ä½œæˆã—ã¾ã™ï¼š

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": {
        "Service": "lambda.amazonaws.com"
      },
      "Action": "sts:AssumeRole"
    }
  ]
}
```

ğŸ’¡ **è§£èª¬**: ã“ã®ä¿¡é ¼ãƒãƒªã‚·ãƒ¼ã¯ã€ŒLambda ã‚µãƒ¼ãƒ“ã‚¹ãŒã“ã®ãƒ­ãƒ¼ãƒ«ã‚’å¼•ãå—ã‘ã‚‹ã“ã¨ã‚’è¨±å¯ã™ã‚‹ã€ã¨ã„ã†æ„å‘³ã§ã™ã€‚
`Principal.Service` ã« `lambda.amazonaws.com` ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€Lambdaé–¢æ•°ã ã‘ãŒã“ã®ãƒ­ãƒ¼ãƒ«ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

#### IAMãƒ­ãƒ¼ãƒ«ä½œæˆ

```bash
aws iam create-role \
  --role-name ic-test-ai-prod-lambda-execution-role \
  --assume-role-policy-document file://trust-policy.json \
  --description "å†…éƒ¨çµ±åˆ¶ãƒ†ã‚¹ãƒˆè©•ä¾¡AI Lambdaå®Ÿè¡Œãƒ­ãƒ¼ãƒ«"
```

æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ï¼š
```json
{
    "Role": {
        "RoleName": "ic-test-ai-prod-lambda-execution-role",
        "Arn": "arn:aws:iam::123456789012:role/ic-test-ai-prod-lambda-execution-role",
        ...
    }
}
```

### å¿…è¦ãªãƒãƒªã‚·ãƒ¼ã®ã‚¢ã‚¿ãƒƒãƒ

Lambdaé–¢æ•°ã«å¿…è¦ãªæ¨©é™ã‚’ãƒ­ãƒ¼ãƒ«ã«è¿½åŠ ã—ã¾ã™ã€‚

```bash
# 1. LambdaåŸºæœ¬å®Ÿè¡Œãƒãƒªã‚·ãƒ¼ï¼ˆCloudWatch Logsã¸ã®ãƒ­ã‚°æ›¸ãè¾¼ã¿æ¨©é™ï¼‰
aws iam attach-role-policy \
  --role-name ic-test-ai-prod-lambda-execution-role \
  --policy-arn arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole

# 2. X-Rayãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°æ¨©é™
aws iam attach-role-policy \
  --role-name ic-test-ai-prod-lambda-execution-role \
  --policy-arn arn:aws:iam::aws:policy/AWSXRayDaemonWriteAccess
```

ğŸ’¡ **AWSç®¡ç†ãƒãƒªã‚·ãƒ¼ã¨ã¯**: `arn:aws:iam::aws:policy/...` ã§å§‹ã¾ã‚‹ãƒãƒªã‚·ãƒ¼ã¯AWSãŒäº‹å‰ã«ç”¨æ„ã—ã¦ãã‚Œã¦ã„ã‚‹ãƒãƒªã‚·ãƒ¼ã§ã™ã€‚
ã‚ˆãä½¿ã‚ã‚Œã‚‹æ¨©é™ã‚»ãƒƒãƒˆãŒã¾ã¨ã‚ã‚‰ã‚Œã¦ãŠã‚Šã€è‡ªåˆ†ã§ä¸€ã‹ã‚‰æ›¸ãå¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“ã€‚

#### ã‚«ã‚¹ã‚¿ãƒ ãƒãƒªã‚·ãƒ¼ã®ä½œæˆï¼ˆBedrockãƒ»Textractç”¨ï¼‰

Bedrock ã¨ Textract ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ã¯ã‚«ã‚¹ã‚¿ãƒ ãƒãƒªã‚·ãƒ¼ã¨ã—ã¦ä½œæˆã—ã¾ã™ã€‚

```bash
# Bedrockå‘¼ã³å‡ºã—ãƒãƒªã‚·ãƒ¼
aws iam put-role-policy \
  --role-name ic-test-ai-prod-lambda-execution-role \
  --policy-name ic-test-ai-prod-lambda-bedrock \
  --policy-document '{
    "Version": "2012-10-17",
    "Statement": [
      {
        "Effect": "Allow",
        "Action": [
          "bedrock:InvokeModel",
          "bedrock:InvokeModelWithResponseStream"
        ],
        "Resource": "*"
      }
    ]
  }'

# Textractå‘¼ã³å‡ºã—ãƒãƒªã‚·ãƒ¼
aws iam put-role-policy \
  --role-name ic-test-ai-prod-lambda-execution-role \
  --policy-name ic-test-ai-prod-lambda-textract \
  --policy-document '{
    "Version": "2012-10-17",
    "Statement": [
      {
        "Effect": "Allow",
        "Action": [
          "textract:AnalyzeDocument",
          "textract:DetectDocumentText"
        ],
        "Resource": "*"
      }
    ]
  }'
```

### ãƒãƒªã‚·ãƒ¼ä¸€è¦§ã¨æœ€å°æ¨©é™ã®åŸå‰‡

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®Lambdaé–¢æ•°ã«å¿…è¦ãªãƒãƒªã‚·ãƒ¼ã®å…¨ä¸€è¦§ï¼š

| ãƒãƒªã‚·ãƒ¼ | ç¨®é¡ | ç›®çš„ |
|---------|------|------|
| `AWSLambdaBasicExecutionRole` | AWSç®¡ç† | CloudWatch Logsã¸ã®ãƒ­ã‚°å‡ºåŠ› |
| `AWSXRayDaemonWriteAccess` | AWSç®¡ç† | X-Rayãƒˆãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ã®é€ä¿¡ |
| `lambda-bedrock`ï¼ˆã‚«ã‚¹ã‚¿ãƒ ï¼‰ | ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ | Bedrockãƒ¢ãƒ‡ãƒ«å‘¼ã³å‡ºã— |
| `lambda-textract`ï¼ˆã‚«ã‚¹ã‚¿ãƒ ï¼‰ | ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ | Textract OCRå‘¼ã³å‡ºã— |
| `lambda-secrets-read`ï¼ˆã‚«ã‚¹ã‚¿ãƒ ï¼‰ | ã‚«ã‚¹ã‚¿ãƒ ç®¡ç† | Secrets Managerã‹ã‚‰ã®èª­ã¿å–ã‚Š |

âš ï¸ **æœ€å°æ¨©é™ã®åŸå‰‡**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã¨ã—ã¦ã€å¿…è¦æœ€ä½é™ã®æ¨©é™ã ã‘ã‚’ä»˜ä¸ã—ã¦ãã ã•ã„ã€‚
`AdministratorAccess` ã‚„ `*`ï¼ˆå…¨ãƒªã‚½ãƒ¼ã‚¹ï¼‰ã®æŒ‡å®šã¯ã€é–‹ç™ºæ®µéšä»¥å¤–ã§ã¯é¿ã‘ã‚‹ã¹ãã§ã™ã€‚
æœ¬ç•ªç’°å¢ƒã§ã¯ã€`Resource` ã«å…·ä½“çš„ãªARNã‚’æŒ‡å®šã—ã¦ãƒªã‚½ãƒ¼ã‚¹ã‚’é™å®šã—ã¦ãã ã•ã„ã€‚

âœ… **ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**: ãƒ­ãƒ¼ãƒ«ã«ä»˜ä¸ã•ã‚ŒãŸãƒãƒªã‚·ãƒ¼ã‚’ç¢ºèªã—ã¾ã™ã€‚

```bash
aws iam list-attached-role-policies \
  --role-name ic-test-ai-prod-lambda-execution-role
```

```bash
aws iam list-role-policies \
  --role-name ic-test-ai-prod-lambda-execution-role
```

---

## 5. AWS Lambda

### ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã¨Lambdaã®ä»•çµ„ã¿

**AWS Lambda** ã¯ã€Œã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã€ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚

**å¾“æ¥ã®ã‚µãƒ¼ãƒãƒ¼æ–¹å¼**:
```
ãƒªã‚¯ã‚¨ã‚¹ãƒˆ â†’ [å¸¸æ™‚ç¨¼åƒã‚µãƒ¼ãƒãƒ¼] â†’ ãƒ¬ã‚¹ãƒãƒ³ã‚¹
ï¼ˆã‚µãƒ¼ãƒãƒ¼ãŒç„¡ãã¦ã‚‚æ–™é‡‘ãŒç™ºç”Ÿï¼‰
```

**Lambdaæ–¹å¼**:
```
ãƒªã‚¯ã‚¨ã‚¹ãƒˆ â†’ [ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œ] â†’ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ â†’ [è‡ªå‹•åœæ­¢]
ï¼ˆå®Ÿè¡Œã—ãŸæ™‚é–“åˆ†ã ã‘æ–™é‡‘ãŒç™ºç”Ÿï¼‰
```

Lambdaã®ç‰¹å¾´ï¼š
- **ã‚µãƒ¼ãƒãƒ¼ç®¡ç†ä¸è¦**: OSã€ãƒ‘ãƒƒãƒé©ç”¨ã€ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã‚’AWSãŒè‡ªå‹•ç®¡ç†
- **å¾“é‡èª²é‡‘**: å®Ÿè¡Œå›æ•°ã¨å®Ÿè¡Œæ™‚é–“ã«å¯¾ã—ã¦èª²é‡‘ï¼ˆã‚¢ã‚¤ãƒ‰ãƒ«æ™‚ã¯ç„¡æ–™ï¼‰
- **è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°**: ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã«å¿œã˜ã¦è‡ªå‹•ã§ä¸¦åˆ—å®Ÿè¡Œæ•°ãŒå¢—æ¸›
- **æœ€å¤§å®Ÿè¡Œæ™‚é–“**: 1å›ã®å®Ÿè¡Œã¯æœ€å¤§15åˆ†ã¾ã§ï¼ˆæœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯540ç§’=9åˆ†ã«è¨­å®šï¼‰

ğŸ’¡ **ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆã¨ã¯**: Lambdaé–¢æ•°ãŒä¸€å®šæ™‚é–“å‘¼ã°ã‚Œãªã„ã¨ã€å®Ÿè¡Œç’°å¢ƒãŒç ´æ£„ã•ã‚Œã¾ã™ã€‚
æ¬¡ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæ¥ã‚‹ã¨ç’°å¢ƒã®å†æ§‹ç¯‰ãŒå¿…è¦ã«ãªã‚Šã€åˆå›ã®å¿œç­”ãŒæ•°ç§’é…ããªã‚Šã¾ã™ã€‚
ã“ã‚Œã‚’ã€Œã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆã€ã¨å‘¼ã³ã¾ã™ã€‚Python 3.11ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã¯æ¯”è¼ƒçš„ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆãŒçŸ­ã„ã§ã™ã€‚

### Lambdaé–¢æ•°ã®è¨­å®šï¼ˆæœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼‰

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®Terraformè¨­å®šã«åŸºã¥ãLambdaé–¢æ•°ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼š

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å€¤ | èª¬æ˜ |
|-----------|-----|------|
| é–¢æ•°å | `ic-test-ai-prod-evaluate` | å†…éƒ¨çµ±åˆ¶ãƒ†ã‚¹ãƒˆè©•ä¾¡é–¢æ•° |
| ãƒ©ãƒ³ã‚¿ã‚¤ãƒ  | `python3.11` | Python 3.11 |
| ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ | `540ç§’`ï¼ˆ9åˆ†ï¼‰ | AIå‡¦ç†ã«ååˆ†ãªæ™‚é–“ |
| ãƒ¡ãƒ¢ãƒª | `1024MB` | Bedrockå‘¼ã³å‡ºã—ã«å¿…è¦ |
| ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚° | `Active`ï¼ˆX-Rayæœ‰åŠ¹ï¼‰ | åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°æœ‰åŠ¹ |
| ãƒãƒ³ãƒ‰ãƒ© | `lambda_handler.handler` | ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ |

### Lambdaé–¢æ•°ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä½œæˆ

Lambdaé–¢æ•°ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹Pythonã‚³ãƒ¼ãƒ‰ã‚’ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ–ã—ã¾ã™ã€‚

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«ç§»å‹•
cd ic-test-ai-agent

# ãƒ‡ãƒ—ãƒ­ã‚¤ç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
mkdir -p build/lambda

# ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼
cp -r src/ build/lambda/
cp platforms/aws/lambda_handler.py build/lambda/

# ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆLambda Layerç”¨ï¼‰
pip install -r requirements.txt -t build/lambda/python/

# ZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
cd build/lambda
zip -r ../../lambda-deployment.zip .
cd ../..
```

ğŸ’¡ **Lambda Layers ã«ã¤ã„ã¦**: ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå¤§ãã„å ´åˆã¯ã€Lambda Layers ã¨ã—ã¦åˆ¥ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚
Layersã‚’ä½¿ã†ã¨ã€ã‚³ãƒ¼ãƒ‰ã¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’åˆ†é›¢ã§ãã€ãƒ‡ãƒ—ãƒ­ã‚¤ãŒé«˜é€Ÿã«ãªã‚Šã¾ã™ã€‚

### ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆï¼ˆSAM CLIï¼‰

ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«ãƒ­ãƒ¼ã‚«ãƒ«ã§Lambdaé–¢æ•°ã‚’ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚

```bash
# AWS SAM CLIã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ - SAMãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½¿ç”¨æ™‚ã®ã¿ï¼‰
pip install aws-sam-cli

# ãƒ­ãƒ¼ã‚«ãƒ«ã§Lambdaé–¢æ•°ã‚’å®Ÿè¡Œ
# â€» æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯Terraformãƒ™ãƒ¼ã‚¹ã®ãŸã‚ã€SAMãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯å«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
# ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆã«ã¯pytestã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
python -m pytest tests/ -v
```

### Lambdaé–¢æ•°ã®æ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤

âš ï¸ **Terraformã‚’ä½¿ã†å ´åˆã¯ä¸è¦**: å¾Œè¿°ã®Terraformãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³12ï¼‰ã§ã¯ã€Lambdaé–¢æ•°ãŒè‡ªå‹•ä½œæˆã•ã‚Œã¾ã™ã€‚
ã“ã“ã§ã¯å­¦ç¿’ç›®çš„ã§æ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã®æ–¹æ³•ã‚’èª¬æ˜ã—ã¦ã„ã¾ã™ã€‚

```bash
# S3ã«ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
aws s3 cp lambda-deployment.zip \
  s3://ic-test-ai-prod-lambda-deployments-123456789012/lambda-deployment.zip

# Lambdaé–¢æ•°ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›´æ–°
aws lambda update-function-code \
  --function-name ic-test-ai-prod-evaluate \
  --s3-bucket ic-test-ai-prod-lambda-deployments-123456789012 \
  --s3-key lambda-deployment.zip
```

æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ï¼š
```json
{
    "FunctionName": "ic-test-ai-prod-evaluate",
    "Runtime": "python3.11",
    "CodeSize": 12345678,
    "LastModified": "2026-02-11T10:00:00.000+0000",
    ...
}
```

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# Lambdaé–¢æ•°ã‚’ç›´æ¥ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
aws lambda invoke \
  --function-name ic-test-ai-prod-evaluate \
  --payload '{"httpMethod": "GET", "path": "/health"}' \
  --cli-binary-format raw-in-base64-out \
  response.json

# ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç¢ºèª
cat response.json
```

âœ… **ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**:
- `StatusCode` ãŒ `200` ã§ã‚ã‚‹ã“ã¨
- `response.json` ã«ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯çµæœãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨

### ç’°å¢ƒå¤‰æ•°è¨­å®š

Lambdaé–¢æ•°ã®ç’°å¢ƒå¤‰æ•°ã¯ã€Terraformè¨­å®šï¼ˆ`lambda.tf`ï¼‰ã§ä»¥ä¸‹ã®ã‚ˆã†ã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ï¼š

| ç’°å¢ƒå¤‰æ•° | å€¤ | èª¬æ˜ |
|---------|-----|------|
| `LLM_PROVIDER` | `AWS` | Bedrockä½¿ç”¨ã‚’æŒ‡å®š |
| `OCR_PROVIDER` | `AWS` | Textractä½¿ç”¨ã‚’æŒ‡å®š |
| `AWS_REGION_NAME` | `ap-northeast-1` | æ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ |
| `DEBUG` | `false` | ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ |
| `FUNCTION_TIMEOUT_SECONDS` | `540` | ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ |

---

## 6. Amazon Bedrock

### Bedrockã¨ã¯

**Amazon Bedrock** ã¯ã€AWSãŒæä¾›ã™ã‚‹ãƒãƒãƒ¼ã‚¸ãƒ‰AIåŸºç›¤ãƒ¢ãƒ‡ãƒ«ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚
APIå‘¼ã³å‡ºã—ã ã‘ã§Claudeã€Titanã€Mistralãªã©ã®å¤§è¦æ¨¡è¨€èªãƒ¢ãƒ‡ãƒ«ï¼ˆLLMï¼‰ã‚’åˆ©ç”¨ã§ãã¾ã™ã€‚

**Bedrockã®åˆ©ç‚¹**:
- ã‚µãƒ¼ãƒãƒ¼ç®¡ç†ä¸è¦ï¼ˆAPIå‘¼ã³å‡ºã—ã®ã¿ï¼‰
- IAMã«ã‚ˆã‚‹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ã‚ˆã‚‹ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¢ã‚¯ã‚»ã‚¹
- å…¥å‡ºåŠ›ãƒ‡ãƒ¼ã‚¿ãŒãƒ¢ãƒ‡ãƒ«ã®å­¦ç¿’ã«ä½¿ã‚ã‚Œãªã„ï¼ˆãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·ï¼‰

### ãƒ¢ãƒ‡ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ç”³è«‹

Bedrockã®ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€äº‹å‰ã«ã‚¢ã‚¯ã‚»ã‚¹ç”³è«‹ãŒå¿…è¦ã§ã™ã€‚

1. AWS Management Console ã«ãƒ­ã‚°ã‚¤ãƒ³
2. ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãŒ **ap-northeast-1ï¼ˆæ±äº¬ï¼‰** ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
3. æ¤œç´¢ãƒãƒ¼ã«ã€ŒBedrockã€ã¨å…¥åŠ›ã—ã€Amazon Bedrockã‚’é–‹ã
4. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ã€ŒModel accessï¼ˆãƒ¢ãƒ‡ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ï¼‰ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
5. ã€ŒManage model accessï¼ˆãƒ¢ãƒ‡ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç®¡ç†ï¼‰ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
6. **Anthropic** ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ã¤ã‘ã€ä»¥ä¸‹ã®ãƒ¢ãƒ‡ãƒ«ã«ãƒã‚§ãƒƒã‚¯ï¼š
   - `Claude 3 Haiku`ï¼ˆé«˜é€Ÿãƒ»ä½ã‚³ã‚¹ãƒˆï¼‰
   - `Claude 3 Sonnet`ï¼ˆãƒãƒ©ãƒ³ã‚¹å‹ãƒ»Visionå¯¾å¿œï¼‰
   - `Claude Sonnet 4.5`ï¼ˆæ¨å¥¨ãƒ»æœ€æ–°ï¼‰
   - `Claude Opus 4.5`ï¼ˆé«˜ç²¾åº¦ï¼‰
7. ã€ŒRequest model accessï¼ˆãƒ¢ãƒ‡ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
8. åˆ©ç”¨è¦ç´„ã«åŒæ„

âš ï¸ **æ‰¿èªå¾…ã¡æ™‚é–“**: é€šå¸¸ã¯æ•°åˆ†ã€œæ•°æ™‚é–“ã§æ‰¿èªã•ã‚Œã¾ã™ãŒã€æœ€å¤§1å–¶æ¥­æ—¥ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒã€ŒAccess grantedã€ã«ãªã‚‹ã¾ã§å¾…ã£ã¦ãã ã•ã„ã€‚

ğŸ’¡ **ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«æ³¨æ„**: ãƒ¢ãƒ‡ãƒ«ã®åˆ©ç”¨å¯èƒ½æ€§ã¯ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚ˆã£ã¦ç•°ãªã‚Šã¾ã™ã€‚
æ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆap-northeast-1ï¼‰ã§ã¯ã€æ—¥æœ¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³æ¨è«–ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`jp.*`ï¼‰ãŒåˆ©ç”¨ã§ãã¾ã™ã€‚

### æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§åˆ©ç”¨å¯èƒ½ãªãƒ¢ãƒ‡ãƒ«ä¸€è¦§

| ãƒ¢ãƒ‡ãƒ«ID | èª¬æ˜ | ç”¨é€” |
|---------|------|------|
| `jp.anthropic.claude-sonnet-4-5-20250929-v1:0` | Claude Sonnet 4.5 (JP) | **æ¨å¥¨**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¢ãƒ‡ãƒ« |
| `global.anthropic.claude-opus-4-6-v1` | Claude Opus 4.6 | ãƒã‚¤ã‚¨ãƒ³ãƒ‰: æœ€é«˜ç²¾åº¦ |
| `global.anthropic.claude-opus-4-5-20251101-v1:0` | Claude Opus 4.5 | é«˜ç²¾åº¦ãƒ¢ãƒ‡ãƒ« |
| `global.anthropic.claude-haiku-4-5-v1` | Claude Haiku 4.5 | ã‚³ã‚¹ãƒˆé‡è¦–: é«˜é€Ÿãƒ»ä½ã‚³ã‚¹ãƒˆ |
| `anthropic.claude-3-sonnet-20240229-v1:0` | Claude 3 Sonnet | Visionï¼ˆç”»åƒèªè­˜ï¼‰å¯¾å¿œ |
| `anthropic.claude-3-haiku-20240307-v1:0` | Claude 3 Haiku | ãƒ¬ã‚¬ã‚·ãƒ¼: æœ€ä½ã‚³ã‚¹ãƒˆ |

ğŸ’¡ **æ¨è«–ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«IDã«ã¤ã„ã¦**: `jp.*` ã‚„ `global.*` ã§å§‹ã¾ã‚‹IDã¯æ¨è«–ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«IDã§ã™ã€‚
On-demandã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆã§ã¯ã€ãƒ¢ãƒ‡ãƒ«IDã§ã¯ãªãæ¨è«–ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«IDã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### Python boto3ã§ã®APIå‘¼ã³å‡ºã—ãƒ†ã‚¹ãƒˆ

Bedrockã®ãƒ¢ãƒ‡ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‰¿èªã•ã‚ŒãŸã‚‰ã€Pythonã‹ã‚‰å‘¼ã³å‡ºã—ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚

```bash
# boto3ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
pip install boto3
```

```python
# bedrock_test.py - Bedrockæ¥ç¶šãƒ†ã‚¹ãƒˆ
import boto3
import json

# Bedrockãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆ
bedrock = boto3.client(
    service_name='bedrock-runtime',
    region_name='ap-northeast-1'
)

# Claude Sonnet 4.5ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
response = bedrock.invoke_model(
    modelId='jp.anthropic.claude-sonnet-4-5-20250929-v1:0',
    contentType='application/json',
    accept='application/json',
    body=json.dumps({
        "anthropic_version": "bedrock-2023-05-31",
        "max_tokens": 256,
        "messages": [
            {
                "role": "user",
                "content": "å†…éƒ¨çµ±åˆ¶ãƒ†ã‚¹ãƒˆã¨ã¯ä½•ã§ã™ã‹ï¼Ÿ50æ–‡å­—ä»¥å†…ã§å›ç­”ã—ã¦ãã ã•ã„ã€‚"
            }
        ]
    })
)

# ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¡¨ç¤º
result = json.loads(response['body'].read())
print("å¿œç­”:", result['content'][0]['text'])
print("ä½¿ç”¨ãƒˆãƒ¼ã‚¯ãƒ³:", result['usage'])
```

```bash
python bedrock_test.py
```

æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ï¼š
```
å¿œç­”: å†…éƒ¨çµ±åˆ¶ãƒ†ã‚¹ãƒˆã¯ã€ä¼æ¥­ã®å†…éƒ¨çµ±åˆ¶ã®æœ‰åŠ¹æ€§ã‚’æ¤œè¨¼ã™ã‚‹è©•ä¾¡æ‰‹ç¶šãã§ã™ã€‚
ä½¿ç”¨ãƒˆãƒ¼ã‚¯ãƒ³: {'input_tokens': 32, 'output_tokens': 28}
```

âœ… **ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**:
- ã‚¨ãƒ©ãƒ¼ãªãå¿œç­”ãŒè¿”ã‚‹ã“ã¨
- `usage` ã«ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨

### ğŸ”§ ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼

| ã‚¨ãƒ©ãƒ¼ | åŸå›  | è§£æ±ºæ–¹æ³• |
|--------|------|----------|
| `AccessDeniedException` | ãƒ¢ãƒ‡ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ãŒæœªæ‰¿èª | Bedrockã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¢ã‚¯ã‚»ã‚¹çŠ¶æ…‹ã‚’ç¢ºèª |
| `ResourceNotFoundException` | ãƒ¢ãƒ‡ãƒ«IDãŒé–“é•ã„ | æ­£ã—ã„æ¨è«–ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«IDã‚’ä½¿ç”¨ |
| `ThrottlingException` | ãƒªã‚¯ã‚¨ã‚¹ãƒˆåˆ¶é™è¶…é | ãƒªãƒˆãƒ©ã‚¤é–“éš”ã‚’ç©ºã‘ã‚‹ |
| `ValidationException` | ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä¸æ­£ | anthropic_versionã‚’ç¢ºèª |

### ç’°å¢ƒå¤‰æ•°è¨­å®šï¼ˆæœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç”¨ï¼‰

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§Bedrockã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¾ã™ï¼š

```bash
# .envãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜è¼‰
LLM_PROVIDER=AWS
AWS_REGION=ap-northeast-1

# ã‚ªãƒ—ã‚·ãƒ§ãƒ³: ãƒ¢ãƒ‡ãƒ«IDã‚’å¤‰æ›´ã™ã‚‹å ´åˆ
AWS_BEDROCK_MODEL_ID=jp.anthropic.claude-sonnet-4-5-20250929-v1:0
```

### ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡ã¨ã‚³ã‚¹ãƒˆ

| ãƒ¢ãƒ‡ãƒ« | å…¥åŠ›ã‚³ã‚¹ãƒˆ (1Kãƒˆãƒ¼ã‚¯ãƒ³) | å‡ºåŠ›ã‚³ã‚¹ãƒˆ (1Kãƒˆãƒ¼ã‚¯ãƒ³) |
|--------|------------------------|------------------------|
| Claude 3 Haiku | $0.00025 | $0.00125 |
| Claude Sonnet 4.5 | $0.003 | $0.015 |
| Claude Opus 4.5 | $0.015 | $0.075 |

ğŸ’¡ **1000ãƒˆãƒ¼ã‚¯ãƒ³ã¯ç´„750å˜èª**ï¼ˆè‹±èªï¼‰ã€æ—¥æœ¬èªã§ã¯ç´„500ã€œ600æ–‡å­—ç¨‹åº¦ã§ã™ã€‚
å†…éƒ¨çµ±åˆ¶ãƒ†ã‚¹ãƒˆ1ä»¶ã‚ãŸã‚Šã®å‡¦ç†ã‚³ã‚¹ãƒˆã¯ã€Claude Sonnet 4.5ã§ç´„$0.01ã€œ$0.05ã§ã™ã€‚

---

## 7. Amazon Textract

### Textractã¨ã¯

**Amazon Textract** ã¯ã€AWSãŒæä¾›ã™ã‚‹OCRï¼ˆå…‰å­¦æ–‡å­—èªè­˜ï¼‰ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚
ã‚¹ã‚­ãƒ£ãƒ³ã•ã‚ŒãŸæ›¸é¡ã‚„PDFã‹ã‚‰ã€ãƒ†ã‚­ã‚¹ãƒˆã€è¡¨ã€ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•çš„ã«æŠ½å‡ºã—ã¾ã™ã€‚

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€å†…éƒ¨çµ±åˆ¶ãƒ†ã‚¹ãƒˆã®è¨¼æ‹ æ›¸é¡ï¼ˆç´™ã®ã‚¹ã‚­ãƒ£ãƒ³ç­‰ï¼‰ã‹ã‚‰ãƒ†ã‚­ã‚¹ãƒˆã‚’æŠ½å‡ºã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã—ã¾ã™ã€‚

### ä½¿ç”¨å¯èƒ½ãªåˆ†æã‚¿ã‚¤ãƒ—

| API | æ©Ÿèƒ½ | æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®ä½¿ç”¨ |
|-----|------|---------------------|
| `DetectDocumentText` | ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºï¼ˆè¡Œãƒ»å˜èªï¼‰ | âœ… ä½¿ç”¨ |
| `AnalyzeDocument` | ãƒ†ã‚­ã‚¹ãƒˆ + è¡¨ + ãƒ•ã‚©ãƒ¼ãƒ  | âœ… ä½¿ç”¨ |
| `AnalyzeExpense` | é ˜åæ›¸ãƒ»è«‹æ±‚æ›¸ã®è§£æ | å¯¾è±¡å¤– |
| `AnalyzeID` | èº«åˆ†è¨¼æ˜æ›¸ã®è§£æ | å¯¾è±¡å¤– |

### Python boto3ã§ã®å‘¼ã³å‡ºã—ãƒ†ã‚¹ãƒˆ

```python
# textract_test.py - Textractæ¥ç¶šãƒ†ã‚¹ãƒˆ
import boto3

# Textractã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆ
textract = boto3.client(
    service_name='textract',
    region_name='ap-northeast-1'
)

# ãƒ†ã‚¹ãƒˆç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ï¼ˆJPEG/PNG/PDFå¯¾å¿œï¼‰
with open('test_document.png', 'rb') as f:
    document_bytes = f.read()

# ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º
response = textract.detect_document_text(
    Document={'Bytes': document_bytes}
)

# çµæœã‚’è¡¨ç¤º
for block in response['Blocks']:
    if block['BlockType'] == 'LINE':
        print(f"  ãƒ†ã‚­ã‚¹ãƒˆ: {block['Text']}")
        print(f"  ä¿¡é ¼åº¦: {block['Confidence']:.1f}%")
        print()
```

```bash
python textract_test.py
```

æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ï¼š
```
  ãƒ†ã‚­ã‚¹ãƒˆ: å†…éƒ¨çµ±åˆ¶ãƒ†ã‚¹ãƒˆçµæœå ±å‘Šæ›¸
  ä¿¡é ¼åº¦: 99.8%

  ãƒ†ã‚­ã‚¹ãƒˆ: æ‰¿èªæ—¥: 2026å¹´1æœˆ15æ—¥
  ä¿¡é ¼åº¦: 98.5%
```

### å¯¾å¿œãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå½¢å¼

| å½¢å¼ | DetectDocumentText | AnalyzeDocument |
|------|-------------------|-----------------|
| JPEG | âœ… | âœ… |
| PNG | âœ… | âœ… |
| PDFï¼ˆ1ãƒšãƒ¼ã‚¸ï¼‰ | âœ… | âœ… |
| PDFï¼ˆè¤‡æ•°ãƒšãƒ¼ã‚¸ï¼‰ | éåŒæœŸAPIãŒå¿…è¦ | éåŒæœŸAPIãŒå¿…è¦ |
| TIFF | âœ… | âœ… |

âš ï¸ **ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™**: åŒæœŸAPIã®å ´åˆã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚µã‚¤ã‚ºã¯æœ€å¤§10MBã§ã™ã€‚
ãã‚Œä»¥ä¸Šã®å ´åˆã¯ã€S3ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦éåŒæœŸAPIã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

âœ… **ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**: TextractãŒãƒ†ã‚­ã‚¹ãƒˆã‚’æ­£ã—ãæŠ½å‡ºã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
æ—¥æœ¬èªã®èªè­˜ç²¾åº¦ã¯è‹±èªã«æ¯”ã¹ã¦è‹¥å¹²ä½ã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
é«˜ç²¾åº¦ãªæ—¥æœ¬èªOCRãŒå¿…è¦ãªå ´åˆã¯ã€YomiTokuç­‰ã®å°‚ç”¨ã‚µãƒ¼ãƒ“ã‚¹ã®åˆ©ç”¨ã‚‚æ¤œè¨ã—ã¦ãã ã•ã„ã€‚

---

## 8. API Gateway

### API Gatewayã¨ã¯

**Amazon API Gateway** ã¯ã€REST/HTTP APIã‚’ä½œæˆãƒ»å…¬é–‹ãƒ»ç®¡ç†ã™ã‚‹ãŸã‚ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚
å¤–éƒ¨ã‹ã‚‰ã®HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã‚Šã€Lambdaé–¢æ•°ã«è»¢é€ã™ã‚‹ã€Œå…¥ã‚Šå£ã€ã®å½¹å‰²ã‚’æœãŸã—ã¾ã™ã€‚

```
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ â†’ [API Gateway] â†’ [Lambda] â†’ [Bedrock/Textract]
  (VBA/        (èªè¨¼ãƒ»åˆ¶é™)   (å‡¦ç†)     (AI/OCR)
   PowerShell)
```

| ç¨®é¡ | ç‰¹å¾´ | æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ |
|------|------|--------------|
| REST API | æ©Ÿèƒ½è±Šå¯Œï¼ˆAPI Keyã€Usage Planã€WAFçµ±åˆï¼‰ | âœ… ä½¿ç”¨ |
| HTTP API | ã‚·ãƒ³ãƒ—ãƒ«ãƒ»ä½ã‚³ã‚¹ãƒˆãƒ»é«˜é€Ÿ | ä¸ä½¿ç”¨ |
| WebSocket API | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæ–¹å‘é€šä¿¡ | ä¸ä½¿ç”¨ |

### æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®APIæ§‹æˆ

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | ãƒ¡ã‚½ãƒƒãƒ‰ | èª¬æ˜ | API Key |
|---------------|---------|------|---------|
| `/evaluate` | POST | å†…éƒ¨çµ±åˆ¶ãƒ†ã‚¹ãƒˆè©•ä¾¡ï¼ˆåŒæœŸï¼‰ | å¿…è¦ |
| `/evaluate/submit` | POST | è©•ä¾¡ã‚¸ãƒ§ãƒ–æŠ•å…¥ï¼ˆéåŒæœŸï¼‰ | å¿…è¦ |
| `/evaluate/status/{job_id}` | GET | ã‚¸ãƒ§ãƒ–çŠ¶æ…‹ç¢ºèª | å¿…è¦ |
| `/evaluate/results/{job_id}` | GET | è©•ä¾¡çµæœå–å¾— | å¿…è¦ |
| `/health` | GET | ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ | ä¸è¦ |
| `/config` | GET | è¨­å®šæƒ…å ±å–å¾— | ä¸è¦ |

### REST APIã®æ‰‹å‹•ä½œæˆ

âš ï¸ **Terraformã‚’ä½¿ã†å ´åˆã¯ä¸è¦**: å¾Œè¿°ã®Terraformãƒ‡ãƒ—ãƒ­ã‚¤ã§ã¯API GatewayãŒè‡ªå‹•ä½œæˆã•ã‚Œã¾ã™ã€‚
ä»¥ä¸‹ã¯å­¦ç¿’ç›®çš„ã®æ‰‹å‹•æ‰‹é †ã§ã™ã€‚

```bash
# REST APIã‚’ä½œæˆ
aws apigateway create-rest-api \
  --name "ic-test-ai-prod-api" \
  --description "å†…éƒ¨çµ±åˆ¶ãƒ†ã‚¹ãƒˆè©•ä¾¡AI API Gateway" \
  --endpoint-configuration '{"types":["REGIONAL"]}'
```

æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ï¼š
```json
{
    "id": "abc123def4",  # pragma: allowlist secret
    "name": "ic-test-ai-prod-api",
    "description": "å†…éƒ¨çµ±åˆ¶ãƒ†ã‚¹ãƒˆè©•ä¾¡AI API Gateway",
    ...
}
```

ğŸ’¡ **REGIONAL vs EDGE**: REGIONALã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ç‰¹å®šãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¾ã™ã€‚
æ—¥æœ¬å›½å†…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä¸»ãªå ´åˆã¯REGIONALãŒé©åˆ‡ã§ã™ã€‚
EDGEã¯CloudFrontã‚’ä½¿ã£ãŸã‚°ãƒ­ãƒ¼ãƒãƒ«é…ä¿¡ã§ã€ä¸–ç•Œä¸­ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã«é©ã—ã¦ã„ã¾ã™ã€‚

### ãƒªã‚½ãƒ¼ã‚¹ã¨ãƒ¡ã‚½ãƒƒãƒ‰å®šç¾©

```bash
# REST API IDã‚’å¤‰æ•°ã«æ ¼ç´
API_ID="abc123def4"  # ä½œæˆæ™‚ã«è¿”ã•ã‚ŒãŸID

# ãƒ«ãƒ¼ãƒˆãƒªã‚½ãƒ¼ã‚¹IDã‚’å–å¾—
ROOT_ID=$(aws apigateway get-resources \
  --rest-api-id $API_ID \
  --query "items[?path=='/'].id" \
  --output text)

# /evaluate ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆ
aws apigateway create-resource \
  --rest-api-id $API_ID \
  --parent-id $ROOT_ID \
  --path-part "evaluate"
```

### Lambdaçµ±åˆè¨­å®š

```bash
# /evaluate ãƒªã‚½ãƒ¼ã‚¹IDã‚’å–å¾—
EVAL_ID=$(aws apigateway get-resources \
  --rest-api-id $API_ID \
  --query "items[?path=='/evaluate'].id" \
  --output text)

# POSTãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½œæˆï¼ˆAPI Keyå¿…é ˆï¼‰
aws apigateway put-method \
  --rest-api-id $API_ID \
  --resource-id $EVAL_ID \
  --http-method POST \
  --authorization-type NONE \
  --api-key-required

# Lambdaçµ±åˆã‚’è¨­å®šï¼ˆAWS_PROXY = Lambdaãƒ—ãƒ­ã‚­ã‚·çµ±åˆï¼‰
aws apigateway put-integration \
  --rest-api-id $API_ID \
  --resource-id $EVAL_ID \
  --http-method POST \
  --type AWS_PROXY \
  --integration-http-method POST \
  --uri "arn:aws:apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/arn:aws:lambda:ap-northeast-1:123456789012:function:ic-test-ai-prod-evaluate/invocations"
```

ğŸ’¡ **Lambdaãƒ—ãƒ­ã‚­ã‚·çµ±åˆï¼ˆAWS_PROXYï¼‰ã¨ã¯**: API GatewayãŒå—ã‘å–ã£ãŸHTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆå…¨ä½“ã‚’
ãã®ã¾ã¾Lambdaé–¢æ•°ã«æ¸¡ã™æ–¹å¼ã§ã™ã€‚Lambdaå´ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®è§£æã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®æ§‹ç¯‰ã‚’è¡Œã„ã¾ã™ã€‚
è¨­å®šãŒã‚·ãƒ³ãƒ—ãƒ«ã§ã€æœ€ã‚‚åºƒãä½¿ã‚ã‚Œã¦ã„ã‚‹çµ±åˆæ–¹å¼ã§ã™ã€‚

### ã‚¹ãƒ†ãƒ¼ã‚¸ä½œæˆã¨ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ä½œæˆ
aws apigateway create-deployment \
  --rest-api-id $API_ID \
  --stage-name prod \
  --description "æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤"
```

ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆURLï¼š
```
https://{API_ID}.execute-api.ap-northeast-1.amazonaws.com/prod/evaluate
```

### API Keyä½œæˆã¨Usage Plan

API Keyã¯ã€APIã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’èªè¨¼ã™ã‚‹ãŸã‚ã®æ–‡å­—åˆ—ã§ã™ã€‚
Usage Planã¯ã€API Keyã”ã¨ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã®åˆ¶é™ã‚’è¨­å®šã—ã¾ã™ã€‚

```bash
# API Keyã‚’ä½œæˆ
aws apigateway create-api-key \
  --name "ic-test-ai-prod-api-key" \
  --description "å†…éƒ¨çµ±åˆ¶ãƒ†ã‚¹ãƒˆè©•ä¾¡AI APIã‚­ãƒ¼" \
  --enabled

# Usage Planã‚’ä½œæˆ
aws apigateway create-usage-plan \
  --name "ic-test-ai-prod-usage-plan" \
  --description "å†…éƒ¨çµ±åˆ¶ãƒ†ã‚¹ãƒˆè©•ä¾¡AI Usage Plan" \
  --api-stages '[{"apiId":"'$API_ID'","stage":"prod"}]' \
  --quota '{"limit":10000,"period":"MONTH"}' \
  --throttle '{"burstLimit":100,"rateLimit":50}'
```

ğŸ’¡ **Usage Planã®è¨­å®šå€¤**:
- `quota.limit=10000`: æœˆé–“æœ€å¤§10,000ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
- `throttle.burstLimit=100`: ãƒãƒ¼ã‚¹ãƒˆæ™‚æœ€å¤§100ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ç§’
- `throttle.rateLimit=50`: å®šå¸¸æ™‚æœ€å¤§50ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ç§’

### ãƒ†ã‚¹ãƒˆå‘¼ã³å‡ºã—

```bash
# API Keyã¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆURLã‚’è¨­å®š
API_KEY="your-api-key-here"  # pragma: allowlist secret
API_URL="https://{API_ID}.execute-api.ap-northeast-1.amazonaws.com/prod"

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆAPI Keyä¸è¦ï¼‰
curl -s "$API_URL/health" | python -m json.tool

# è©•ä¾¡ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆAPI Keyå¿…è¦ï¼‰
curl -s -X POST "$API_URL/evaluate" \
  -H "Content-Type: application/json" \
  -H "x-api-key: $API_KEY" \
  -H "X-Correlation-ID: test-$(date +%s)" \
  -d '{
    "test_type": "walkthrough",
    "control_description": "æ‰¿èªãƒ—ãƒ­ã‚»ã‚¹ã®æ•´å‚™çŠ¶æ³ãƒ†ã‚¹ãƒˆ",
    "evidence": "æ‰¿èªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®è¨­å®šç”»é¢ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ"
  }' | python -m json.tool
```

âœ… **ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**:
- ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãŒ `200 OK` ã‚’è¿”ã™ã“ã¨
- API Keyä»˜ããƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæ­£å¸¸ã«å‡¦ç†ã•ã‚Œã‚‹ã“ã¨
- API Keyãªã—ã®POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒ `403 Forbidden` ã‚’è¿”ã™ã“ã¨

---

## 9. Secrets Manager

### Secrets Managerã¨ã¯

**AWS Secrets Manager** ã¯ã€APIã‚­ãƒ¼ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€ãã®ä»–ã®æ©Ÿå¯†æƒ…å ±ã‚’å®‰å…¨ã«ä¿å­˜ãƒ»ç®¡ç†ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚

**ãªãœSecrets Managerã‚’ä½¿ã†ã®ã‹**:
- ã‚³ãƒ¼ãƒ‰ã«ç›´æ¥APIã‚­ãƒ¼ã‚’æ›¸ãã®ã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯
- ç’°å¢ƒå¤‰æ•°ã¯è¨­å®šãƒŸã‚¹ã§æ¼æ´©ã—ã‚„ã™ã„
- Secrets Managerã¯æš—å·åŒ–ãƒ»ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãƒ»ç›£æŸ»ãƒ­ã‚°ã‚’æä¾›
- è‡ªå‹•ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå®šæœŸçš„ãªã‚­ãƒ¼æ›´æ–°ï¼‰ã«å¯¾å¿œ

### ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆä½œæˆ

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€Terraformã«ã‚ˆã£ã¦ä»¥ä¸‹ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãŒè‡ªå‹•ä½œæˆã•ã‚Œã¾ã™ã€‚

```bash
# Bedrock API Keyï¼ˆIAMãƒ­ãƒ¼ãƒ«èªè¨¼ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ä¸è¦ï¼‰
aws secretsmanager create-secret \
  --name "ic-test-ai-prod-bedrock-api-key" \
  --description "AWS Bedrock API Key for LLM operations" \
  --secret-string "REPLACE_WITH_ACTUAL_API_KEY" \
  --region ap-northeast-1

# Textract API Keyï¼ˆIAMãƒ­ãƒ¼ãƒ«èªè¨¼ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ä¸è¦ï¼‰
aws secretsmanager create-secret \
  --name "ic-test-ai-prod-textract-api-key" \
  --description "AWS Textract API Key for OCR operations" \
  --secret-string "REPLACE_WITH_ACTUAL_API_KEY" \
  --region ap-northeast-1

# OpenAI API Keyï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
aws secretsmanager create-secret \
  --name "ic-test-ai-prod-openai-api-key" \
  --description "OpenAI API Key (fallback)" \
  --secret-string "NOT_CONFIGURED" \
  --region ap-northeast-1
```

ğŸ’¡ **Bedrock/Textractã®èªè¨¼ã«ã¤ã„ã¦**: Lambdaé–¢æ•°ã¯IAMãƒ­ãƒ¼ãƒ«ã«ã‚ˆã£ã¦Bedrock/Textractã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚
ãã®ãŸã‚ã€API Keyã‚’ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã«ä¿å­˜ã™ã‚‹å¿…è¦ã¯é€šå¸¸ã‚ã‚Šã¾ã›ã‚“ã€‚
Secrets Managerã¯ä¸»ã«ã€å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆOpenAIç­‰ï¼‰ã®APIã‚­ãƒ¼ç®¡ç†ã«ä½¿ç”¨ã—ã¾ã™ã€‚

### ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®å€¤ã‚’æ›´æ–°

```bash
# ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã®å€¤ã‚’æ›´æ–°
aws secretsmanager put-secret-value \
  --secret-id "ic-test-ai-prod-bedrock-api-key" \
  --secret-string "å®Ÿéš›ã®APIã‚­ãƒ¼å€¤"
```

### Python boto3ã§ã®ã‚¢ã‚¯ã‚»ã‚¹

```python
# secrets_test.py - Secrets Manageræ¥ç¶šãƒ†ã‚¹ãƒˆ
import boto3
import json

# Secrets Managerã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆ
client = boto3.client(
    service_name='secretsmanager',
    region_name='ap-northeast-1'
)

# ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’å–å¾—
response = client.get_secret_value(
    SecretId='ic-test-ai-prod-bedrock-api-key'  # pragma: allowlist secret
)

# å€¤ã‚’è¡¨ç¤ºï¼ˆæœ¬ç•ªã§ã¯çµ¶å¯¾ã«ãƒ­ã‚°å‡ºåŠ›ã—ãªã„ã“ã¨ï¼‰
secret = response['SecretString']
print(f"ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆå–å¾—æˆåŠŸ: {secret[:10]}...")
```

### Lambdaé–¢æ•°ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹è¨­å®š

Lambdaé–¢æ•°ã‹ã‚‰Secrets Managerã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ã€IAMãƒãƒªã‚·ãƒ¼ãŒå¿…è¦ã§ã™ã€‚
æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®Terraformã§ã¯ã€`lambda_secrets_read` ãƒãƒªã‚·ãƒ¼ãŒè‡ªå‹•ä½œæˆã•ã‚Œã€
ä»¥ä¸‹ã®æ¨©é™ãŒLambdaå®Ÿè¡Œãƒ­ãƒ¼ãƒ«ã«ä»˜ä¸ã•ã‚Œã¾ã™ï¼š

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "secretsmanager:GetSecretValue",
        "secretsmanager:DescribeSecret"
      ],
      "Resource": [
        "arn:aws:secretsmanager:ap-northeast-1:123456789012:secret:ic-test-ai-prod-bedrock-api-key-*",
        "arn:aws:secretsmanager:ap-northeast-1:123456789012:secret:ic-test-ai-prod-textract-api-key-*",
        "arn:aws:secretsmanager:ap-northeast-1:123456789012:secret:ic-test-ai-prod-openai-api-key-*"
      ]
    }
  ]
}
```

âš ï¸ **æœ€å°æ¨©é™**: `Resource` ã«å…·ä½“çš„ãªã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆARNã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€
Lambdaé–¢æ•°ãŒã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’é™å®šã—ã¦ã„ã¾ã™ã€‚`"Resource": "*"` ã¯é¿ã‘ã¦ãã ã•ã„ã€‚

### ç™»éŒ²ã™ã¹ãã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆä¸€è¦§

| ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆå | å¿…é ˆ | èª¬æ˜ |
|---------------|------|------|
| `ic-test-ai-prod-bedrock-api-key` | ã„ã„ãˆï¼ˆIAMãƒ­ãƒ¼ãƒ«ä½¿ç”¨æ™‚ï¼‰ | Bedrock API Key |
| `ic-test-ai-prod-textract-api-key` | ã„ã„ãˆï¼ˆIAMãƒ­ãƒ¼ãƒ«ä½¿ç”¨æ™‚ï¼‰ | Textract API Key |
| `ic-test-ai-prod-openai-api-key` | ã„ã„ãˆ | OpenAI APIã‚­ãƒ¼ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ï¼‰ |

âœ… **ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**: ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

```bash
aws secretsmanager list-secrets \
  --filter Key="name",Values="ic-test-ai" \
  --query "SecretList[].Name" \
  --output table
```

---

## 10. CloudWatch / X-Ray

### CloudWatchã¨ã¯

**Amazon CloudWatch** ã¯ã€AWSãƒªã‚½ãƒ¼ã‚¹ã®ç›£è¦–ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚
3ã¤ã®ä¸»è¦æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ï¼š

| æ©Ÿèƒ½ | èª¬æ˜ |
|------|------|
| **CloudWatch Logs** | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚°ã®åé›†ãƒ»ä¿å­˜ãƒ»æ¤œç´¢ |
| **CloudWatch Metrics** | ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼ˆæ•°å€¤ãƒ‡ãƒ¼ã‚¿ï¼‰ã®åé›†ãƒ»ã‚°ãƒ©ãƒ•è¡¨ç¤º |
| **CloudWatch Alarms** | ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãŒé–¾å€¤ã‚’è¶…ãˆãŸå ´åˆã«é€šçŸ¥ |

### æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®CloudWatchè¨­å®š

Terraformã§ä»¥ä¸‹ã®ãƒªã‚½ãƒ¼ã‚¹ãŒè‡ªå‹•ä½œæˆã•ã‚Œã¾ã™ï¼š

**ãƒ­ã‚°ã‚°ãƒ«ãƒ¼ãƒ—**:
- `/aws/lambda/ic-test-ai-prod-evaluate` - Lambdaé–¢æ•°ãƒ­ã‚°ï¼ˆä¿æŒæœŸé–“: 30æ—¥ï¼‰
- `/aws/apigateway/ic-test-ai-prod-api` - API Gatewayã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ï¼ˆä¿æŒæœŸé–“: 30æ—¥ï¼‰

**ã‚¢ãƒ©ãƒ¼ãƒ **:
| ã‚¢ãƒ©ãƒ¼ãƒ å | ç›£è¦–å¯¾è±¡ | é–¾å€¤ |
|-----------|---------|------|
| `lambda-errors` | Lambdaã‚¨ãƒ©ãƒ¼æ•° | 5åˆ†é–“ã§10å›ä»¥ä¸Š |
| `lambda-throttles` | Lambdaã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚° | 5åˆ†é–“ã§5å›ä»¥ä¸Š |
| `lambda-duration` | Lambdaå®Ÿè¡Œæ™‚é–“ | å¹³å‡3åˆ†ä»¥ä¸Š |
| `api-gateway-4xx` | API 4xxã‚¨ãƒ©ãƒ¼ | 5åˆ†é–“ã§20å›ä»¥ä¸Š |
| `api-gateway-5xx` | API 5xxã‚¨ãƒ©ãƒ¼ | 5åˆ†é–“ã§5å›ä»¥ä¸Š |

**ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰**:
`ic-test-ai-prod-dashboard` ã«Lambdaã¨API Gatewayã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãŒä¸€è¦§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

### X-Rayã¨ã¯

**AWS X-Ray** ã¯ã€åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ï¼ˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã®çµŒè·¯è¿½è·¡ï¼‰ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚
APIãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã©ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’çµŒç”±ã—ã€å„ã‚¹ãƒ†ãƒƒãƒ—ã§ä½•ç§’ã‹ã‹ã£ãŸã‹ã‚’å¯è¦–åŒ–ã—ã¾ã™ã€‚

```
ãƒªã‚¯ã‚¨ã‚¹ãƒˆ â†’ API Gateway (50ms) â†’ Lambda (2500ms) â†’ Bedrock (2000ms)
                                                   â†’ Textract (800ms)
```

X-Rayã‚’ä½¿ã†ã¨ï¼š
- **ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ç‰¹å®š**: ã©ã®ã‚¹ãƒ†ãƒƒãƒ—ãŒé…ã„ã‹ãŒä¸€ç›®ã§åˆ†ã‹ã‚‹
- **ã‚¨ãƒ©ãƒ¼è¿½è·¡**: ã©ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸã‹ç‰¹å®šã§ãã‚‹
- **ã‚µãƒ¼ãƒ“ã‚¹ãƒãƒƒãƒ—**: ã‚µãƒ¼ãƒ“ã‚¹é–“ã®ä¾å­˜é–¢ä¿‚ã‚’å¯è¦–åŒ–

### Lambdaé–¢æ•°ã®X-Rayæœ‰åŠ¹åŒ–

Terraformã§ã¯ `tracing_config.mode = "Active"` ã§è‡ªå‹•æœ‰åŠ¹åŒ–ã•ã‚Œã¾ã™ã€‚
æ‰‹å‹•ã§æœ‰åŠ¹åŒ–ã™ã‚‹å ´åˆï¼š

```bash
aws lambda update-function-configuration \
  --function-name ic-test-ai-prod-evaluate \
  --tracing-config Mode=Active
```

æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ï¼ˆä¸€éƒ¨ï¼‰ï¼š
```json
{
    "TracingConfig": {
        "Mode": "Active"
    }
}
```

### CloudWatch Logsã‚¯ã‚¨ãƒªä¾‹

CloudWatch Logs Insightsã‚’ä½¿ã£ã¦ã€ãƒ­ã‚°ã‚’æ¤œç´¢ãƒ»åˆ†æã§ãã¾ã™ã€‚

```bash
# AWS CLIã‹ã‚‰CloudWatch Logs Insightsã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œ
aws logs start-query \
  --log-group-name "/aws/lambda/ic-test-ai-prod-evaluate" \
  --start-time $(date -d '1 hour ago' +%s) \
  --end-time $(date +%s) \
  --query-string 'fields @timestamp, @message | filter @message like /ERROR/ | sort @timestamp desc | limit 20'
```

ã‚ˆãä½¿ã†ã‚¯ã‚¨ãƒªãƒ‘ã‚¿ãƒ¼ãƒ³ï¼š

```
# ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®æ¤œç´¢
fields @timestamp, @message
| filter @message like /ERROR/
| sort @timestamp desc
| limit 20

# ç›¸é–¢IDã«ã‚ˆã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆè¿½è·¡
fields @timestamp, @message, correlation_id
| filter correlation_id like /your-correlation-id-here/
| sort @timestamp asc

# Lambdaå®Ÿè¡Œæ™‚é–“ã®çµ±è¨ˆ
stats avg(duration), max(duration), min(duration), count(*) as invocations
by bin(5m) as time_window

# ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆã®æ¤œå‡º
fields @timestamp, @message
| filter @message like /REPORT/
| parse @message "Init Duration: * ms" as initDuration
| filter ispresent(initDuration)
| sort @timestamp desc
```

ğŸ’¡ **ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ã®ç¢ºèªæ–¹æ³•**:
1. AWS Console â†’ CloudWatch â†’ Log Insights
2. ãƒ­ã‚°ã‚°ãƒ«ãƒ¼ãƒ—ã§ `/aws/lambda/ic-test-ai-prod-evaluate` ã‚’é¸æŠ
3. ä¸Šè¨˜ã‚¯ã‚¨ãƒªã‚’ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆã—ã¦ã€ŒRun queryã€

### X-Rayã‚µãƒ¼ãƒ“ã‚¹ãƒãƒƒãƒ—ã®è¦‹æ–¹

1. AWS Console â†’ X-Ray â†’ Service map
2. æ™‚é–“ç¯„å›²ã‚’é¸æŠï¼ˆéå»1æ™‚é–“ãªã©ï¼‰
3. ã‚µãƒ¼ãƒ“ã‚¹ãƒãƒƒãƒ—ãŒè¡¨ç¤ºã•ã‚Œã‚‹

ã‚µãƒ¼ãƒ“ã‚¹ãƒãƒƒãƒ—ã®èª­ã¿æ–¹ï¼š
- **ãƒãƒ¼ãƒ‰**: å„ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆAPI Gatewayã€Lambdaã€Bedrockç­‰ï¼‰
- **ã‚¨ãƒƒã‚¸**: ã‚µãƒ¼ãƒ“ã‚¹é–“ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ•ãƒ­ãƒ¼
- **è‰²**: ç·‘=æ­£å¸¸ã€é»„=4xxã‚¨ãƒ©ãƒ¼ã€èµ¤=5xxã‚¨ãƒ©ãƒ¼
- **ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·**: å„ãƒãƒ¼ãƒ‰ã®å¹³å‡å¿œç­”æ™‚é–“

âœ… **ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**:
```bash
# Terraformå‡ºåŠ›ã‹ã‚‰ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰URLã‚’å–å¾—
# (Terraformãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã«ä½¿ç”¨)
terraform output cloudwatch_dashboard_url
terraform output xray_service_map_url
```

---

## 11. S3

### S3ã¨ã¯

**Amazon S3ï¼ˆSimple Storage Serviceï¼‰** ã¯ã€AWSã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚
ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰ã‚’å®‰å…¨ã«ä¿å­˜ãƒ»å–å¾—ã§ãã¾ã™ã€‚

åŸºæœ¬æ¦‚å¿µï¼š
- **ãƒã‚±ãƒƒãƒˆ**: ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…¥ã‚Œã‚‹ã€Œç®±ã€ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«ã§ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªåå‰ãŒå¿…è¦ï¼‰
- **ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ**: ãƒã‚±ãƒƒãƒˆå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«
- **ã‚­ãƒ¼**: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è­˜åˆ¥åï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã«ç›¸å½“ï¼‰

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€Lambdaé–¢æ•°ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’S3ã«ä¿å­˜ã—ã¾ã™ã€‚

### ãƒã‚±ãƒƒãƒˆä½œæˆ

```bash
# S3ãƒã‚±ãƒƒãƒˆã‚’ä½œæˆï¼ˆæ±äº¬ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰
# ãƒã‚±ãƒƒãƒˆåã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«ã§ãƒ¦ãƒ‹ãƒ¼ã‚¯ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
aws s3api create-bucket \
  --bucket ic-test-ai-prod-lambda-deployments-123456789012 \
  --region ap-northeast-1 \
  --create-bucket-configuration LocationConstraint=ap-northeast-1
```

ğŸ’¡ **ãƒã‚±ãƒƒãƒˆåã®ãƒ«ãƒ¼ãƒ«**:
- ã‚°ãƒ­ãƒ¼ãƒãƒ«ã§ãƒ¦ãƒ‹ãƒ¼ã‚¯ï¼ˆä»–ã®AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨é‡è¤‡ä¸å¯ï¼‰
- 3ã€œ63æ–‡å­—
- å°æ–‡å­—ã€æ•°å­—ã€ãƒã‚¤ãƒ•ãƒ³ã®ã¿ä½¿ç”¨å¯èƒ½
- æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯æœ«å°¾ã«AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆIDã‚’ä»˜ã‘ã¦ãƒ¦ãƒ‹ãƒ¼ã‚¯æ€§ã‚’ç¢ºä¿ã—ã¦ã„ã¾ã™

```bash
# ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã‚’æœ‰åŠ¹åŒ–ï¼ˆèª¤å‰Šé™¤é˜²æ­¢ï¼‰
aws s3api put-bucket-versioning \
  --bucket ic-test-ai-prod-lambda-deployments-123456789012 \
  --versioning-configuration Status=Enabled
```

### Python boto3ã§ã®ã‚¢ã‚¯ã‚»ã‚¹

```python
# s3_test.py - S3æ¥ç¶šãƒ†ã‚¹ãƒˆ
import boto3

s3 = boto3.client('s3', region_name='ap-northeast-1')

# ãƒã‚±ãƒƒãƒˆå†…ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§
response = s3.list_objects_v2(
    Bucket='ic-test-ai-prod-lambda-deployments-123456789012',
    MaxKeys=10
)

for obj in response.get('Contents', []):
    print(f"  {obj['Key']} ({obj['Size']:,} bytes)")
```

âœ… **ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**: ãƒã‚±ãƒƒãƒˆãŒä½œæˆã•ã‚Œã€ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã€‚

```bash
# ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
echo "test" > /tmp/test.txt
aws s3 cp /tmp/test.txt s3://ic-test-ai-prod-lambda-deployments-123456789012/test.txt

# ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç¢ºèª
aws s3 ls s3://ic-test-ai-prod-lambda-deployments-123456789012/

# ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
aws s3 rm s3://ic-test-ai-prod-lambda-deployments-123456789012/test.txt
```

---

## 12. Terraformãƒ‡ãƒ—ãƒ­ã‚¤

### IaCã¨Terraformã®æ¦‚è¦

**IaCï¼ˆInfrastructure as Codeï¼‰** ã¨ã¯ã€ã‚¤ãƒ³ãƒ•ãƒ©æ§‹æˆã‚’ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦ç®¡ç†ã™ã‚‹æ‰‹æ³•ã§ã™ã€‚
æ‰‹å‹•ã§AWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’æ“ä½œã™ã‚‹ä»£ã‚ã‚Šã«ã€ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã‚¤ãƒ³ãƒ•ãƒ©ã‚’å®šç¾©ãƒ»æ§‹ç¯‰ã—ã¾ã™ã€‚

**Terraformã®åˆ©ç‚¹**:
- **å†ç¾æ€§**: åŒã˜ã‚³ãƒ¼ãƒ‰ã‹ã‚‰åŒã˜ç’°å¢ƒã‚’ä½•åº¦ã§ã‚‚ä½œæˆã§ãã‚‹
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†**: Gitã§ã‚¤ãƒ³ãƒ•ãƒ©ã®å¤‰æ›´å±¥æ­´ã‚’è¿½è·¡ã§ãã‚‹
- **è‡ªå‹•åŒ–**: ã‚³ãƒãƒ³ãƒ‰1ã¤ã§å…¨ãƒªã‚½ãƒ¼ã‚¹ã‚’ä¸€æ‹¬ä½œæˆ/å‰Šé™¤ã§ãã‚‹
- **ãƒãƒ«ãƒã‚¯ãƒ©ã‚¦ãƒ‰**: AWSã€Azureã€GCPã‚’åŒã˜ãƒ„ãƒ¼ãƒ«ã§ç®¡ç†ã§ãã‚‹

### Terraformã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

#### Windows ã®å ´åˆ

```bash
# Chocolateyã‚’ä½¿ã†å ´åˆ
choco install terraform

# ã¾ãŸã¯æ‰‹å‹•ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
# https://developer.hashicorp.com/terraform/downloads

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª
terraform --version
```

æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ï¼š
```
Terraform v1.x.x
on windows_amd64
```

#### macOS ã®å ´åˆ

```bash
brew install terraform
terraform --version
```

#### Linux ã®å ´åˆ

```bash
# HashiCorp GPGã‚­ãƒ¼ã‚’è¿½åŠ 
wget -O- https://apt.releases.hashicorp.com/gpg | sudo gpg --dearmor -o /usr/share/keyrings/hashicorp-archive-keyring.gpg

# ãƒªãƒã‚¸ãƒˆãƒªã‚’è¿½åŠ 
echo "deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/hashicorp.list

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo apt update && sudo apt install terraform
terraform --version
```

### æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®Terraformãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
infrastructure/aws/terraform/
â”œâ”€â”€ backend.tf          # Terraformãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è¨­å®šï¼ˆStateç®¡ç†ï¼‰
â”œâ”€â”€ variables.tf        # å¤‰æ•°å®šç¾©ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã€ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ç­‰ï¼‰
â”œâ”€â”€ lambda.tf           # Lambdaé–¢æ•° + IAMãƒ­ãƒ¼ãƒ« + S3ãƒã‚±ãƒƒãƒˆ
â”œâ”€â”€ api-gateway.tf      # API Gateway + API Key + Usage Plan
â”œâ”€â”€ secrets-manager.tf  # Secrets Manager + IAMãƒãƒªã‚·ãƒ¼
â”œâ”€â”€ cloudwatch.tf       # CloudWatch Alarms + Dashboard + X-Ray
â””â”€â”€ outputs.tf          # å‡ºåŠ›å€¤å®šç¾©ï¼ˆURLã€ARNç­‰ï¼‰
```

å„ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²ï¼š

| ãƒ•ã‚¡ã‚¤ãƒ« | ä½œæˆã•ã‚Œã‚‹ãƒªã‚½ãƒ¼ã‚¹ |
|---------|-------------------|
| `backend.tf` | Terraformè¨­å®šï¼ˆãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€Stateä¿å­˜å…ˆï¼‰ |
| `variables.tf` | è¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å®šç¾©ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤å«ã‚€ï¼‰ |
| `lambda.tf` | Lambdaé–¢æ•°ã€IAMãƒ­ãƒ¼ãƒ«ã€S3ãƒã‚±ãƒƒãƒˆã€CloudWatch Logs |
| `api-gateway.tf` | REST APIã€ãƒªã‚½ãƒ¼ã‚¹ã€ãƒ¡ã‚½ãƒƒãƒ‰ã€ã‚¹ãƒ†ãƒ¼ã‚¸ã€API Key |
| `secrets-manager.tf` | ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ3ç¨® + Lambdaèª­ã¿å–ã‚Šãƒãƒªã‚·ãƒ¼ |
| `cloudwatch.tf` | ã‚¢ãƒ©ãƒ¼ãƒ 5ç¨® + ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ + X-Rayã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ãƒ«ãƒ¼ãƒ« |
| `outputs.tf` | ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®é‡è¦æƒ…å ±ï¼ˆURLã€ARNç­‰ï¼‰ |

### terraform initï¼ˆåˆæœŸåŒ–ï¼‰

Terraformã®åˆæœŸåŒ–ã‚’è¡Œã„ã¾ã™ã€‚ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒè¡Œã‚ã‚Œã¾ã™ã€‚

```bash
cd infrastructure/aws/terraform
terraform init
```

æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ï¼š
```
Initializing the backend...

Initializing provider plugins...
- Finding hashicorp/aws versions matching "~> 5.0"...
- Installing hashicorp/aws v5.x.x...
- Installed hashicorp/aws v5.x.x (signed by HashiCorp)

Terraform has been successfully initialized!
```

ğŸ’¡ **`terraform init` ã¯ä»¥ä¸‹ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å®Ÿè¡Œã—ã¾ã™**:
- åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ™‚
- `backend.tf` ã‚’å¤‰æ›´ã—ãŸæ™‚
- æ–°ã—ã„ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’è¿½åŠ ã—ãŸæ™‚

### terraform planï¼ˆå®Ÿè¡Œè¨ˆç”»ã®ç¢ºèªï¼‰

å®Ÿéš›ã«ãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹å‰ã«ã€ä½•ãŒä½œæˆã•ã‚Œã‚‹ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚

```bash
# å¤‰æ•°ã‚’è¨­å®šï¼ˆç’°å¢ƒå¤‰æ•°ã¾ãŸã¯terraform.tfvarsï¼‰
export TF_VAR_project_name="ic-test-ai"
export TF_VAR_environment="prod"
export TF_VAR_region="ap-northeast-1"

# å®Ÿè¡Œè¨ˆç”»ã‚’è¡¨ç¤º
terraform plan -out=tfplan
```

æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ï¼ˆä¸€éƒ¨ï¼‰ï¼š
```
Terraform used the selected providers to generate the following execution plan.

  # aws_api_gateway_api_key.ic_test_ai will be created
  + resource "aws_api_gateway_api_key" "ic_test_ai" {
      + name    = "ic-test-ai-prod-api-key"
      + enabled = true
      ...
    }

  # aws_lambda_function.ic_test_ai will be created
  + resource "aws_lambda_function" "ic_test_ai" {
      + function_name = "ic-test-ai-prod-evaluate"
      + runtime       = "python3.11"
      + memory_size   = 1024
      + timeout       = 540
      ...
    }

Plan: 25 to add, 0 to change, 0 to destroy.
```

âš ï¸ **å¿…ãš `plan` ã®å‡ºåŠ›ã‚’ç¢ºèªã—ã¦ãã ã•ã„**: äºˆæœŸã—ãªã„ãƒªã‚½ãƒ¼ã‚¹ã®å‰Šé™¤ï¼ˆdestroyï¼‰ãŒãªã„ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚
ç‰¹ã« `to destroy` ã®ã‚«ã‚¦ãƒ³ãƒˆãŒ0ã§ã‚ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚

### terraform applyï¼ˆãƒªã‚½ãƒ¼ã‚¹ä½œæˆï¼‰

```bash
# ç¢ºèªæ¸ˆã¿ã®ãƒ—ãƒ©ãƒ³ã‚’é©ç”¨
terraform apply tfplan
```

é€”ä¸­ã§ãƒ—ãƒ©ãƒ³ãªã—ã§ç›´æ¥é©ç”¨ã™ã‚‹å ´åˆï¼š
```bash
terraform apply
```

ã€ŒDo you want to perform these actions?ã€ã¨ç¢ºèªã•ã‚Œã‚‹ã®ã§ `yes` ã¨å…¥åŠ›ã—ã¾ã™ã€‚

æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ï¼ˆå®Œäº†å¾Œï¼‰ï¼š
```
Apply complete! Resources: 25 added, 0 changed, 0 destroyed.

Outputs:

api_gateway_endpoint = "https://abc123def4.execute-api.ap-northeast-1.amazonaws.com/prod/evaluate"
api_key = <sensitive>
cloudwatch_dashboard_url = "https://console.aws.amazon.com/cloudwatch/..."
lambda_function_name = "ic-test-ai-prod-evaluate"
xray_service_map_url = "https://console.aws.amazon.com/xray/..."
```

### å‡ºåŠ›å€¤ã®ç¢ºèª

```bash
# å…¨å‡ºåŠ›å€¤ã‚’è¡¨ç¤º
terraform output

# API Keyã‚’è¡¨ç¤ºï¼ˆsensitiveå€¤ï¼‰
terraform output -raw api_key

# ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆURLã‚’è¡¨ç¤º
terraform output api_gateway_endpoint
```

é‡è¦ãªå‡ºåŠ›å€¤ï¼š

| å‡ºåŠ›å | ç”¨é€” |
|--------|------|
| `api_gateway_endpoint` | VBA/PowerShellã«è¨­å®šã™ã‚‹APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ |
| `api_key` | VBA/PowerShellã«è¨­å®šã™ã‚‹API Key |
| `lambda_function_name` | ã‚³ãƒ¼ãƒ‰ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«æŒ‡å®šã™ã‚‹é–¢æ•°å |
| `s3_bucket_name` | ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å…ˆ |
| `cloudwatch_dashboard_url` | ç›£è¦–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®URL |

### Terraform Stateç®¡ç†ï¼ˆS3ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼‰

âš ï¸ **ãƒãƒ¼ãƒ é–‹ç™ºæ™‚ã¯å¿…é ˆ**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯Terraform StateãŒãƒ­ãƒ¼ã‚«ãƒ«PCã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚
ãƒãƒ¼ãƒ ã§é–‹ç™ºã™ã‚‹å ´åˆã¯ã€S3ã«Stateã‚’ä¿å­˜ã—ã¦å…±æœ‰ã—ã¾ã™ã€‚

```bash
# Stateä¿å­˜ç”¨S3ãƒã‚±ãƒƒãƒˆã‚’ä½œæˆ
aws s3api create-bucket \
  --bucket ic-test-ai-terraform-state \
  --region ap-northeast-1 \
  --create-bucket-configuration LocationConstraint=ap-northeast-1

# ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã‚’æœ‰åŠ¹åŒ–
aws s3api put-bucket-versioning \
  --bucket ic-test-ai-terraform-state \
  --versioning-configuration Status=Enabled

# State ãƒ­ãƒƒã‚¯ç”¨DynamoDBãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆ
aws dynamodb create-table \
  --table-name ic-test-ai-terraform-locks \
  --attribute-definitions AttributeName=LockID,AttributeType=S \
  --key-schema AttributeName=LockID,KeyType=HASH \
  --provisioned-throughput ReadCapacityUnits=1,WriteCapacityUnits=1 \
  --region ap-northeast-1
```

ãã®å¾Œã€`backend.tf` ã®S3ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è¨­å®šã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’å¤–ã—ã¦ `terraform init -reconfigure` ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

### terraform destroyï¼ˆã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼‰

å…¨ãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤ã™ã‚‹å ´åˆï¼š

```bash
terraform destroy
```

âš ï¸ **æ³¨æ„**: `terraform destroy` ã¯ä½œæˆã—ãŸå…¨ãƒªã‚½ãƒ¼ã‚¹ã‚’å‰Šé™¤ã—ã¾ã™ã€‚
æœ¬ç•ªç’°å¢ƒã§ã¯å®Ÿè¡Œã—ãªã„ã§ãã ã•ã„ã€‚ç¢ºèªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§ `yes` ã‚’å…¥åŠ›ã™ã‚‹ã¨å‰Šé™¤ãŒé–‹å§‹ã•ã‚Œã¾ã™ã€‚

ğŸ’¡ **ä¸€éƒ¨ã®ãƒªã‚½ãƒ¼ã‚¹ã ã‘ã‚’å‰Šé™¤ã™ã‚‹å ´åˆ**:
```bash
# ç‰¹å®šã®ãƒªã‚½ãƒ¼ã‚¹ã ã‘ã‚’å‰Šé™¤
terraform destroy -target=aws_cloudwatch_metric_alarm.lambda_errors
```

---

## 13. çµ±åˆãƒ†ã‚¹ãƒˆ

### ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå®Œäº†ã—ãŸã‚‰ã€ã¾ãšãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã§ã‚·ã‚¹ãƒ†ãƒ ã®çŠ¶æ…‹ã‚’ç¢ºèªã—ã¾ã™ã€‚

```bash
# Terraformå‡ºåŠ›ã‹ã‚‰ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å–å¾—
API_URL=$(terraform output -raw api_gateway_endpoint | sed 's|/evaluate||')
API_KEY=$(terraform output -raw api_key)

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl -s "$API_URL/health" | python -m json.tool
```

æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ï¼š
```json
{
    "status": "healthy",
    "platform": "aws",
    "llm_provider": "AWS",
    "ocr_provider": "AWS",
    "timestamp": "2026-02-11T10:00:00Z"
}
```

### /evaluate ãƒ†ã‚¹ãƒˆ

```bash
# åŒæœŸè©•ä¾¡ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
curl -s -X POST "$API_URL/evaluate" \
  -H "Content-Type: application/json" \
  -H "x-api-key: $API_KEY" \
  -H "X-Correlation-ID: integration-test-001" \
  -d '{
    "test_type": "walkthrough",
    "control_description": "è³¼è²·æ‰¿èªãƒ—ãƒ­ã‚»ã‚¹ã«ãŠã‘ã‚‹æ‰¿èªæ¨©é™ã®é©åˆ‡ãªè¨­å®šã‚’ç¢ºèªã™ã‚‹",
    "evidence": "æ‰¿èªæ¨©é™ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è¨­å®šç”»é¢ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã€ãƒ†ã‚¹ãƒˆæœŸé–“ä¸­ã®æ‰¿èªãƒ­ã‚°10ä»¶",
    "assertion": "å…¨ã¦ã®è³¼è²·ç”³è«‹ãŒé©åˆ‡ãªæ¨©é™è€…ã«ã‚ˆã‚Šæ‰¿èªã•ã‚Œã¦ã„ã‚‹"
  }' | python -m json.tool
```

æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ï¼ˆä¸€éƒ¨ï¼‰ï¼š
```json
{
    "correlation_id": "integration-test-001",
    "evaluation_result": {
        "test_type": "walkthrough",
        "effectiveness": "effective",
        "confidence_score": 0.85,
        "findings": [...],
        "recommendations": [...]
    }
}
```

### ç›¸é–¢IDä¼æ’­ç¢ºèª

ç›¸é–¢IDï¼ˆCorrelation IDï¼‰ã¯ã€1ã¤ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒè¤‡æ•°ã‚µãƒ¼ãƒ“ã‚¹ã‚’é€šéã™ã‚‹éš›ã«ã€
ãã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¿½è·¡ã™ã‚‹ãŸã‚ã®ä¸€æ„ã®IDã§ã™ã€‚

```bash
# ä¸€æ„ã®ç›¸é–¢IDã‚’ç”Ÿæˆ
CORR_ID="trace-$(date +%s)-$(openssl rand -hex 4)"
echo "ç›¸é–¢ID: $CORR_ID"

# ç›¸é–¢IDä»˜ããƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡
curl -s -X POST "$API_URL/evaluate" \
  -H "Content-Type: application/json" \
  -H "x-api-key: $API_KEY" \
  -H "X-Correlation-ID: $CORR_ID" \
  -d '{"test_type": "walkthrough", "control_description": "ãƒ†ã‚¹ãƒˆ"}' \
  | python -m json.tool

# CloudWatch Logsã§ç›¸é–¢IDã‚’æ¤œç´¢
aws logs start-query \
  --log-group-name "/aws/lambda/ic-test-ai-prod-evaluate" \
  --start-time $(date -d '10 minutes ago' +%s) \
  --end-time $(date +%s) \
  --query-string "fields @timestamp, @message | filter @message like /$CORR_ID/ | sort @timestamp asc"
```

âœ… **ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**:
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«åŒã˜ `correlation_id` ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨
- CloudWatch Logsã§ç›¸é–¢IDã‚’å«ã‚€ãƒ­ã‚°ã‚¨ãƒ³ãƒˆãƒªãŒè¦‹ã¤ã‹ã‚‹ã“ã¨
- X-Rayãƒˆãƒ¬ãƒ¼ã‚¹ã«ã‚‚ç›¸é–¢IDãŒã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã—ã¦è¨˜éŒ²ã•ã‚Œã¦ã„ã‚‹ã“ã¨

### CloudWatchã§ãƒ­ã‚°ç¢ºèª

```bash
# Lambdaé–¢æ•°ã®æœ€æ–°ãƒ­ã‚°ã‚’ç¢ºèª
aws logs tail "/aws/lambda/ic-test-ai-prod-evaluate" \
  --since 10m \
  --format short
```

ğŸ’¡ **ãƒ–ãƒ©ã‚¦ã‚¶ã§ã®ç¢ºèª**: Terraformå‡ºåŠ›ã® `cloudwatch_logs_url` ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ãã¨ã€
CloudWatch Logsã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ç›´æ¥ãƒ­ã‚°ã‚’ç¢ºèªã§ãã¾ã™ã€‚

### ğŸ”§ çµ±åˆãƒ†ã‚¹ãƒˆã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

| å•é¡Œ | ç¢ºèªãƒã‚¤ãƒ³ãƒˆ | è§£æ±ºæ–¹æ³• |
|------|------------|----------|
| 502 Bad Gateway | Lambdaé–¢æ•°ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ | S3ã®ZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã€`lambda_handler.handler`ãŒæ­£ã—ã„ã‹ç¢ºèª |
| 403 Forbidden | API Key | `x-api-key` ãƒ˜ãƒƒãƒ€ãƒ¼ã®å€¤ã‚’ç¢ºèª |
| 504 Gateway Timeout | Lambda ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ | ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå€¤ã‚’ç¢ºèªï¼ˆ540ç§’ã§ååˆ†ã‹ï¼‰ |
| Internal Server Error | Lambdaå®Ÿè¡Œã‚¨ãƒ©ãƒ¼ | CloudWatch Logsã‚’ç¢ºèª |
| Bedrockã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼ | IAMãƒãƒªã‚·ãƒ¼ | Bedrockãƒãƒªã‚·ãƒ¼ãŒã‚¢ã‚¿ãƒƒãƒã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª |

---

## 14. ã‚³ã‚¹ãƒˆç®¡ç†

### ç„¡æ–™æ ã®ç¯„å›²

AWSã®ç„¡æ–™æ ï¼ˆ12ã‹æœˆé–“ï¼‰ï¼š

| ã‚µãƒ¼ãƒ“ã‚¹ | ç„¡æ–™æ  |
|---------|--------|
| Lambda | 100ä¸‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/æœˆ + 40ä¸‡GBç§’ |
| API Gateway | 100ä¸‡APIå‘¼ã³å‡ºã—/æœˆï¼ˆ12ã‹æœˆé–“ï¼‰ |
| CloudWatch | åŸºæœ¬ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ç„¡æ–™ã€ãƒ­ã‚°5GB/æœˆ |
| S3 | 5GBæ¨™æº–ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ |
| Secrets Manager | 30æ—¥é–“ç„¡æ–™ãƒˆãƒ©ã‚¤ã‚¢ãƒ« |
| X-Ray | 10ä¸‡ãƒˆãƒ¬ãƒ¼ã‚¹/æœˆ |

âš ï¸ **Bedrockã¯ç„¡æ–™æ ãªã—**: Bedrockã®ãƒ¢ãƒ‡ãƒ«å‘¼ã³å‡ºã—ã¯æœ€åˆã‹ã‚‰èª²é‡‘ã•ã‚Œã¾ã™ã€‚
ãƒ†ã‚¹ãƒˆæ®µéšã§ã¯Claude 3 Haikuï¼ˆæœ€å®‰ï¼‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

### ã‚³ã‚¹ãƒˆè¦‹ç©ã‚‚ã‚Šï¼ˆæœˆé–“100ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å ´åˆï¼‰

| ã‚µãƒ¼ãƒ“ã‚¹ | æ¦‚ç®—ã‚³ã‚¹ãƒˆ |
|---------|-----------|
| Lambdaï¼ˆ100å› x å¹³å‡30ç§’ x 1024MBï¼‰ | ~$0.05 |
| API Gatewayï¼ˆ100ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰ | ~$0.001 |
| Bedrock - Claude Sonnet 4.5ï¼ˆ100å›ï¼‰ | ~$1.00ã€œ$5.00 |
| Bedrock - Claude 3 Haikuï¼ˆ100å›ï¼‰ | ~$0.05ã€œ$0.15 |
| CloudWatch Logs | ~$0.50 |
| Secrets Managerï¼ˆ3ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆï¼‰ | ~$1.20 |
| S3 | ~$0.01 |
| **åˆè¨ˆï¼ˆSonnet 4.5ä½¿ç”¨æ™‚ï¼‰** | **~$3ã€œ$7/æœˆ** |
| **åˆè¨ˆï¼ˆHaikuä½¿ç”¨æ™‚ï¼‰** | **~$2ã€œ$3/æœˆ** |

ğŸ’¡ **ã‚³ã‚¹ãƒˆæœ€é©åŒ–ã®ãƒ’ãƒ³ãƒˆ**:
- é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆæ®µéšã§ã¯Claude 3 Haiku ã‚’ä½¿ç”¨
- ä¸è¦ãªCloudWatch Logsã¯ä¿æŒæœŸé–“ã‚’çŸ­ç¸®ï¼ˆ30æ—¥â†’7æ—¥ï¼‰
- ä½¿ã‚ãªããªã£ãŸç’°å¢ƒã¯ `terraform destroy` ã§å‰Šé™¤

### Billing Dashboardã®ç¢ºèª

```bash
# ç¾åœ¨ã®æœˆé–“ã‚³ã‚¹ãƒˆã‚’ç¢ºèªï¼ˆCost Explorer APIï¼‰
aws ce get-cost-and-usage \
  --time-period Start=2026-02-01,End=2026-02-28 \
  --granularity MONTHLY \
  --metrics "BlendedCost" \
  --group-by Type=DIMENSION,Key=SERVICE
```

âš ï¸ **ã‚³ã‚¹ãƒˆã‚¢ãƒ©ãƒ¼ãƒˆã®è¨­å®šã‚’æ¨å¥¨**: äºˆæœŸã—ãªã„èª²é‡‘ã‚’é˜²ããŸã‚ã€
AWS Budgets ã§ã‚¢ãƒ©ãƒ¼ãƒˆã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚

1. AWS Console â†’ Billing â†’ Budgets
2. ã€ŒCreate a budgetã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. æœˆé–“äºˆç®—ã‚’è¨­å®šï¼ˆä¾‹: $10ï¼‰
4. äºˆç®—ã®80%ã«é”ã—ãŸã‚‰ãƒ¡ãƒ¼ãƒ«é€šçŸ¥

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®Terraformã§ã¯ã€`cost_alert_threshold` å¤‰æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: $100/æœˆï¼‰ã§
ã‚³ã‚¹ãƒˆã‚¢ãƒ©ãƒ¼ãƒ ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚

---

## 15. ã¾ã¨ã‚ãƒ»æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] AWSã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ãŸ
- [ ] AWS CLIã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€`aws configure`ã‚’å®Œäº†ã—ãŸ
- [ ] `aws sts get-caller-identity` ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹
- [ ] Bedrockãƒ¢ãƒ‡ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ãŒã€ŒAccess grantedã€ã«ãªã£ãŸ
- [ ] Terraformã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸ
- [ ] `terraform init` / `plan` / `apply` ãŒæˆåŠŸã—ãŸ
- [ ] ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆ`/health`ï¼‰ãŒ `200 OK` ã‚’è¿”ã™
- [ ] `/evaluate` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒæ­£ã—ãå¿œç­”ã™ã‚‹
- [ ] CloudWatch Logsã«ãƒ­ã‚°ãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã‚‹
- [ ] X-Rayã‚µãƒ¼ãƒ“ã‚¹ãƒãƒƒãƒ—ã«ãƒˆãƒ¬ãƒ¼ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ã‚³ã‚¹ãƒˆã‚¢ãƒ©ãƒ¼ãƒˆã‚’è¨­å®šã—ãŸ

### é‡è¦ãªå‡ºåŠ›å€¤ã®ä¿å­˜

ä»¥ä¸‹ã®å€¤ã‚’VBA/PowerShellã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«è¨­å®šã—ã¦ãã ã•ã„ï¼š

```bash
# ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆURL
terraform output api_gateway_endpoint

# API Key
terraform output -raw api_key
```

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **VBA/PowerShellã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®è¨­å®š**: ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆURLã¨API Keyã‚’è¨­å®š
2. **é‹ç”¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ç¢ºèª**: [DEPLOYMENT_GUIDE.md](../operations/DEPLOYMENT_GUIDE.md)
3. **CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®æ§‹ç¯‰**: GitHub Actionsã¨ã®é€£æº
4. **æœ¬ç•ªç’°å¢ƒã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–**: WAFã€VPCã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã€IAMãƒãƒªã‚·ãƒ¼ã®çµã‚Šè¾¼ã¿
5. **ãƒãƒ«ãƒç’°å¢ƒï¼ˆdev/stg/prodï¼‰ã®æ§‹ç¯‰**: Terraform workspaces ã®æ´»ç”¨

### å‚è€ƒè³‡æ–™

- [AWSå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.aws.amazon.com/)
- [Terraform AWS Provider](https://registry.terraform.io/providers/hashicorp/aws/)
- [Amazon Bedrock ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.aws.amazon.com/bedrock/)
- [AWS Lambda ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.aws.amazon.com/lambda/)
- [API Gateway ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.aws.amazon.com/apigateway/)
- [æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ Deployment Guide](../operations/DEPLOYMENT_GUIDE.md)
- [æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ AWS Terraform README](../../infrastructure/aws/README.md)

---

> ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯å†…éƒ¨çµ±åˆ¶ãƒ†ã‚¹ãƒˆè©•ä¾¡AIã‚·ã‚¹ãƒ†ãƒ ã®AWSç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰ã§ã™ã€‚
> è³ªå•ã‚„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãŒã‚ã‚‹å ´åˆã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®Issueã«å ±å‘Šã—ã¦ãã ã•ã„ã€‚
