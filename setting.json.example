{
    "_readme": [
        "=== 設定ファイル説明（この配列はプログラムに無視されます）===",
        "",
        "【apiClient設定】",
        "  POWERSHELL = PowerShellスクリプト経由（デフォルト、推奨）",
        "  VBA        = VBAネイティブHTTP（PowerShell禁止環境用）",
        "  EXPORT     = ファイルエクスポートのみ（PowerShell+VBA両方禁止環境用）",
        "",
        "【EXPORTモードの使い方】",
        "  1. ProcessForExportマクロを実行 → JSONファイルがエクスポートされる",
        "  2. web/index.html をブラウザで開き、JSONをアップロード",
        "  3. 評価完了後、結果JSONをダウンロード",
        "  4. ImportResultsマクロを実行 → 結果をExcelにインポート",
        "",
        "asyncMode: true=非同期モード（推奨、504タイムアウト対策）, false=同期モード",
        "batchSize: 一度に処理する項目数（5-20推奨、非同期モードなら大きくても可）",
        "pollingIntervalSec: 非同期モード時のポーリング間隔（秒）。5-10推奨",
        "sheetName: 対象シート名。空欄=アクティブシート",
        "dataStartRow: データ開始行（ヘッダー行の次）",
        "columns: Excel列マッピング。A,B,C...で指定",
        "api.provider: AZURE, GCP, AWS のいずれか",
        "api.endpoint: APIのベースURL（/evaluateまで）",
        "api.authType: 認証方式。azureAd=Azure AD認証（推奨）, functionsKey=Functions Key認証",
        "azureAd: Azure AD認証設定（authType: azureAdの場合に必要）",
        "responseMapping: API応答を書き込むExcel列",
        "booleanDisplayTrue/False: 評価結果の表示文字列"
    ],

    "_dataStartRow": "データの開始行（ヘッダー行の次）",
    "dataStartRow": 2,

    "_sheetName": "対象シート名（空の場合はアクティブシートを使用）",
    "sheetName": "",

    "_batchSize": "1回のAPI呼び出しで処理する件数（5-20推奨、非同期モードなら大きくても可）",
    "batchSize": 10,

    "_asyncMode": "非同期モード（推奨）。trueで504タイムアウト回避",
    "asyncMode": true,

    "_pollingIntervalSec": "非同期モード時のポーリング間隔（秒）",
    "pollingIntervalSec": 5,

    "_apiClient": "API呼び出し方式。POWERSHELL（推奨）またはVBA",
    "apiClient": "POWERSHELL",

    "_columns": "Excel入力列の定義（A-F: 入力、G: フィードバック入力、H: 再評価回数自動更新）",
    "columns": {
        "ID": "A",
        "TestTarget": "B",
        "Category": "C",
        "ControlDescription": "D",
        "TestProcedure": "E",
        "EvidenceLink": "F",
        "Feedback": "G",
        "ReevalCount": "H"
    },

    "_api": "=== APIプロバイダー設定 ===",
    "_api_provider": "AZURE / GCP / AWS のいずれかを指定",
    "_api_authType": "認証方式: azureAd（本番環境推奨）または functionsKey（開発環境用）",
    "_api_endpoint_note": "APIM経由: https://<APIM名>.azure-api.net/api/evaluate, Container Apps直接: https://<CA名>.azurecontainerapps.io/evaluate",
    "api": {
        "provider": "AZURE",
        "endpoint": "https://<APIM名>.azure-api.net/api/evaluate",
        "authType": "functionsKey",
        "apiKey": "<APIM_SUBSCRIPTION_KEY>",
        "authHeader": "Ocp-Apim-Subscription-Key"
    },

    "_azureAd": "=== Azure AD認証設定（authType: azureAdの場合に必要）===",
    "_azureAd_note": "Azure ADグループによるアクセス制限を行う場合に設定（本番環境推奨）",
    "_azureAd_tenantId": "会社のAzure ADテナントID（Azure Portal → Microsoft Entra ID → 概要で確認）",
    "_azureAd_clientId": "App RegistrationのクライアントID（Azure Portal → アプリの登録 → 概要で確認）",
    "_azureAd_scope": "APIスコープ。user_impersonation + openid + offline_access（トークンキャッシュに必要）",
    "azureAd": {
        "tenantId": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
        "clientId": "yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy",
        "scope": "api://yyyyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy/user_impersonation openid offline_access"
    },

    "_responseMapping": "=== APIレスポンスのExcel出力列マッピング ===",
    "_responseMapping_note": "APIから返されるJSONキー名と出力先のExcel列を対応付け（G-H列はフィードバック用に予約）",
    "responseMapping": {
        "evaluationResult": "I",
        "executionPlanSummary": "J",
        "judgmentBasis": "K",
        "documentReference": "L",
        "feedbackApplied": "M",
        "resultChanged": "N",
        "evidenceFileNames": "O"
    },

    "_booleanDisplay": "=== Boolean値の表示設定 ===",
    "_booleanDisplay_note": "evaluationResultがtrue/falseの場合の表示テキスト",
    "booleanDisplayTrue": "有効",
    "booleanDisplayFalse": "非有効",

    "_api_examples": "=== プロバイダー別の設定例 ===",

    "_azure_apim_example": {
        "_description": "Azure APIM経由（本番環境推奨）",
        "_note1": "APIM Subscription Keyで認証",
        "_note2": "非同期: /api/evaluate/submit → /api/evaluate/status/{id} → /api/evaluate/results/{id}",
        "api": {
            "provider": "AZURE",
            "authType": "functionsKey",
            "endpoint": "https://<APIM名>.azure-api.net/api/evaluate",
            "apiKey": "<APIM_SUBSCRIPTION_KEY>",
            "authHeader": "Ocp-Apim-Subscription-Key"
        }
    },

    "_azure_direct_example": {
        "_description": "Azure Container Apps 直接接続（開発・テスト用）",
        "_note": "APIMを経由しないため /api/ プレフィックスは不要",
        "api": {
            "provider": "AZURE",
            "authType": "functionsKey",
            "endpoint": "https://<CA名>.azurecontainerapps.io/evaluate",
            "apiKey": "",
            "authHeader": ""
        }
    },

    "_azure_ad_example": {
        "_description": "Azure AD認証（APIM + Entra ID連携時）",
        "_note1": "Azure ADグループで許可されたユーザーのみアクセス可能",
        "_note2": "トークンキャッシュにより2回目以降はブラウザ認証不要",
        "api": {
            "provider": "AZURE",
            "authType": "azureAd",
            "endpoint": "https://<APIM名>.azure-api.net/api/evaluate"
        },
        "azureAd": {
            "tenantId": "your-tenant-id",
            "clientId": "your-client-id",
            "scope": "api://your-client-id/user_impersonation openid offline_access"
        }
    },

    "_gcp_example": {
        "_description": "Google Cloud Run の設定例",
        "api": {
            "provider": "GCP",
            "authType": "functionsKey",
            "endpoint": "https://<CLOUD_RUN_URL>/evaluate",
            "apiKey": "your-bearer-token",
            "authHeader": "Authorization"
        }
    },

    "_aws_example": {
        "_description": "AWS App Runner (API Gateway) の設定例",
        "api": {
            "provider": "AWS",
            "authType": "functionsKey",
            "endpoint": "https://xxxxx.execute-api.ap-northeast-1.amazonaws.com/prod/evaluate",
            "apiKey": "your-api-key",
            "authHeader": "x-api-key"
        }
    },

    "_expected_request": "=== APIに送信されるJSON形式 ===",
    "_request_note": "EvidenceLinkフォルダ内のファイルは自動的にBase64変換されてEvidenceFilesに追加される",
    "_request_example": [
        {
            "ID": "IC-001",
            "TestTarget": "購買プロセス",
            "Category": "業務統制",
            "ControlDescription": "アクセス権限の承認プロセス",
            "TestProcedure": "承認記録を確認する",
            "EvidenceLink": "C:\\Evidence\\IC-001",
            "EvidenceFiles": [
                {
                    "fileName": "approval_record.pdf",
                    "extension": ".pdf",
                    "mimeType": "application/pdf",
                    "base64": "JVBERi0xLjQK..."
                },
                {
                    "fileName": "screenshot.png",
                    "extension": ".png",
                    "mimeType": "image/png",
                    "base64": "iVBORw0KGgo..."
                }
            ]
        }
    ],

    "_mimeType_usage": "=== API側でのmimeType活用例 ===",
    "_mimeType_note": "mimeTypeでファイル種別を判定し、適切な処理に分岐可能",
    "_mimeType_examples": {
        "application/pdf": "PDF解析またはOCR",
        "image/*": "画像OCR (Vision API等)",
        "application/vnd.ms-outlook": "Outlookメール解析（.msg）- 承認メール等",
        "message/rfc822": "メール解析（.eml/.mht）",
        "application/vnd.openxmlformats-officedocument.*": "Office文書解析",
        "application/vnd.ms-excel*": "Excel解析（マクロ有無含む）",
        "text/*": "テキスト/ログ直接処理",
        "application/vnd.ms-access": "Accessデータベース",
        "application/octet-stream": "バイナリ（ERPログ、監査証跡等）"
    },

    "_supported_extensions": "=== 対応ファイル形式一覧 ===",
    "_extensions_list": {
        "文書": [".pdf", ".doc", ".docx", ".rtf"],
        "表計算": [".xls", ".xlsx", ".xlsm", ".csv"],
        "プレゼン": [".ppt", ".pptx"],
        "メール": [".msg", ".eml", ".oft", ".pst"],
        "画像": [".jpg", ".png", ".gif", ".bmp", ".tiff", ".heic"],
        "Web保存": [".html", ".mht", ".mhtml"],
        "ログ": [".txt", ".log", ".evt", ".evtx", ".aud"],
        "ERP出力": [".spool", ".alv"],
        "DB/レポート": [".mdb", ".accdb", ".rpt"],
        "図面": [".vsd", ".vsdx"],
        "圧縮": [".zip", ".7z", ".rar"]
    },

    "_expected_response": "=== 期待するAPIレスポンス形式 ===",
    "_response_note": "feedbackApplied/resultChanged/reevaluationRoundはフィードバック再評価時に返される",
    "_response_example": [
        {
            "ID": "IC-001",
            "evaluationResult": true,
            "executionPlanSummary": "[A5:意味推論] 承認プロセスの有効性を評価",
            "judgmentBasis": "承認記録が適切に保存されている",
            "documentReference": "内部統制規程 第3条",
            "fileName": "approval_record.pdf",
            "feedbackApplied": false,
            "reevaluationRound": 0,
            "resultChanged": false
        }
    ]
}
